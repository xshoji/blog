[{"title":"Brunoで環境変数を一時的に上書きする方法","permalink":"/posts/20260224_bruno-set-environment-var-temporary/","date":"2026-02-24","summary":"以前 Postman を使っていたが、環境変数を一時的に違う値に上書きする機能が地味に便利だった。\nGuide on How to Persist Postman Variables | Postman Blog\nhttps://blog.postman.com/how-to-persist-postman-variables/ この機能を使うことで、今だけ\n操作対象のアカウントIDを違うIDに切 …","tags":["bruno","environment variable","temporary","setEnvVar"],"content":"以前 Postman を使っていたが、環境変数を一時的に違う値に上書きする機能が地味に便利だった。 Guide on How to Persist Postman Variables | Postman Blog https://blog.postman.com/how-to-persist-postman-variables/ この機能を使うことで、今だけ 操作対象のアカウントIDを違うIDに切り替える リクエスト先のバージョンを変更する といったことが可能で、かつ環境変数の元の値は変更しないので作業が終わったら全て元に戻す、ということが可能だった。 InsomniaやBrunoでは対応していなかったので、普段書き換える時は環境変数を書き換えたり、頻繁にやるなら環境ごとコピーしたり面倒だった。 実はBrunoでも環境変数の一時的な上書きが可能 できないと思ってたんですが、少し調べたところ、 Bruno の Javascript API にある setEnvVar というAPIで環境変数を書き換えられるんですが、このAPIはデフォルトでメモリ上にのみ保存され、オプションを指定しない限り永続化されないらしい。 JavaScript API Reference | Bruno Docs https://docs.usebruno.com/testing/script/javascript-reference ─ setEnvVar(key, value, options?) - By default, environment variables are temporary and do not persist between app restarts. 実際やってみると、見た目上は Environment の値が書き換わったように見える（ちょっと焦ります）が、公式ドキュメントに記載されてる通り、メモリ上の一時的な上書きであり、永続化オプション（例: { persist: true }）を指定しない限り、再起動でリセットされる。 このため、Environmentの設定を汚さずに一時的に値を書き換えたい場合は、 Collection や Request の設定にある「Script」内に // bru.setEnvVar(key, value); bru.setEnvVar(\u0026amp;#34;userId\u0026amp;#34;, \u0026amp;#34;hogehoge\u0026amp;#34;); を記述すれば環境変数の一時的な上書きが可能だということがわかった。 ちなみに、永続化オプション { persist: true } を指定すると、環境変数の値を上書きすることもできる。 bru.setEnvVar(\u0026amp;#34;userId\u0026amp;#34;, \u0026amp;#34;hogehoge\u0026amp;#34;, { persist: true }); ちなみに Postman の同機能はなんと廃止済みらしい この記事を書く時に調べてて気づいたのだが、 Postman にあった、環境変数を一時的に上書きする機能、昨年廃止されていた。 After Postman update no initial and current value anymore - Help Hub - Postman Community https://community.postman.com/t/after-postman-update-no-initial-and-current-value-anymore/84510 えぇ\u0026amp;hellip;この機能は本当にめちゃくちゃ便利だったのに残念。 Postmanから乗り換えて良かった!!! "},{"title":"AmpCodeの広告付き無料プランの1日のクレジットでできること:smartモードとrushモードの比較","permalink":"/posts/20260214_ampcode-free-1day-challenge/","date":"2026-02-14","summary":"はじめに ampcodeには、3つのモードがある。\nagent-modes - Owner’s Manual - Amp\nhttps://ampcode.com/manual#agent-modes 今回はsmartモードとrushモードで「1日（$10）でどこまで作れるのか」っていうのが気になって検証してしまった。深夜2時に。\n","tags":["ampcode","ai coding","free plan","rush","smart"],"content":"はじめに ampcodeには、3つのモードがある。 agent-modes - Owner’s Manual - Amp https://ampcode.com/manual#agent-modes 今回はsmartモードとrushモードで「1日（$10）でどこまで作れるのか」っていうのが気になって検証してしまった。深夜2時に。 実装させるアプリの題材はわりと真面目なやつで、社内外ナレッジ共有アプリ。Next.jsで、投稿あって、コメントあって、認証あって、管理画面もあって、みたいなやつ。純粋な実装コストだけをみたかったので、最初の要件はあらかじめ用意しておきコストに含めず、それぞれファイル0の状態から同じ要件を伝えて開発させた。あと、サーバーサイドを混ぜると検証がややこしくなるので今回はフロントエンドの実装に絞って開発させることにした。 ちなみに、今回の検証時点でのモデルは smartモード: Claude Opus 4.6 rushモード: Claude Haiku 4.5 となっている。 まずsmartモード 計画立ててくださいで0.66ドル。ここまではまあいい。create-next-appして、型定義して、認証と投稿機能作って、なんやかんやで一通り完成。ここまでで4ドル弱。一通り作って4ドルだから、まあ安いなって感じ。 ただ、デザインが黒背景に黒文字。超絶ダークモード。 直してもらって、マイページ未実装なのを突っ込んで、管理画面追加して、/adminがリダイレクト地獄になってるのをデバッグして、UIを一般公開レベルに引き上げろと無茶振りして、改善項目を一個ずつやらせて……。 気づいたら10ドル超えてた。 # 最終的なコード行数 45 files changed +2949 ~15 -67 最後、記事の新規作成ができないという基本機能が動いていない致命的なバグがあったが、コスト上限で直せず。 ただまぁ、なんか、終始ちゃんとやってくれてる感じはあった。丁寧。堅実。1回の指示に対する完成度は高い。 ただし、やっぱり単純な指示であっても、コストが消費されてるなと感じるタイミングが何度かあった。 指示の内容とかかったコストをまとめておく。 指示内容 コスト($) 実装計画 0.66 プロジェクト初期化 0.81 型定義・ユーティリティ・共通コンポーネント 1.98 認証・投稿の基礎実装 3.16 全実装完了 3.92 デザイン見直し 4.18 マイページ実装 4.62 管理画面の実装計画 5.22 管理画面実装（既存修正） 5.91 管理画面実装（全ファイル作成） 6.55 /admin不具合調査 7.19 リダイレクト問題対応 7.59 全体デザイン再設計 8.44 改善項目1対応 9.13 改善項目2対応 9.70 新規投稿ボタン不具合 10.23 次の日はrushモード 計画立ててください。0.04ドル。 安っ。 実装お願いします。0.59ドル。23 files changed。1860行追加。 とにかく作業が早い。 ただ、初期のUIはめっちゃひどかった。CSSどこ行った。でも安い。とにかく安い。牛丼より安い。 デザイン改善の提案も一瞬で、ちゃんと考えてるのか不安になる速度。ただ、修正させてみると、Tailwindのバージョンでエラー吐きまくりながらも、最終的に出てきたUIが、普通に綺麗。 Haiku\u0026amp;hellip;いけますね。 そこからはもう、追加したい機能を思いつく限り指示してやりたい放題。 ログイン後の表示変えろ。管理画面追加しろ。Hydrationエラー直せ。admin自動生成しろ。初期データ100件入れろ。リアクション追加しろ。スレッド機能つけろ。メンション通知つけろ。スペース入りユーザー名対応しろ。DM機能をLINEみたいにしろ。 実装は早いが、エラーは出る。出まくる。Hydration failed地獄。SSRとClientのズレ。metadataがどうとか。ビルドエラーとの殴り合い。ただ、殴れば直る。方向修正すればついてくる。 コンテキスト上限は流石にsmartモードよりも小さいためコスト半分くらいのところで一度99%に。一回/newでリセットしてまた殴るを続けました。 最終的に、モリモリに要件を盛り込んで9ドルちょい。 # 最終的なコード行数（一度リセットしてるので、2つのスレッドに分かれてる） +1826-172~154, 18 messages, 132 tool uses ampcode_rush +6320-18~18, 11 messages, 109 tool uses ampcode_rush 体感でsmartモードに比べてrushモードは4〜5倍は作業させられると感じた。smartが熟練エンジニアなら、rushはタフで安いジュニア大量投入みたいな感じ。ミスるけど、数で殴れる。しかも安い。 あまりに安かったので、ロゴ生成とかfaviconとか、実装外の作業もやらせてしまった。そんな余裕があるのも地味に熱い。コスト上限に到達した頃、気づいたらすごくリッチな見た目になっていた。 趣味で0から個人サービス作るなら、amp freeでrush回して方向だけちゃんと握っておけば、全然戦える気がした。 こっちも指示の内容とかかったコストをまとめておく。 指示内容 コスト($) 実装計画 0.04 初回実装 0.59 デザイン改修提案 0.67 Tailwind対応など 1.58 ログイン後UI修正 1.92 管理画面追加 2.4 Hydrationエラー対応① 2.75 admin自動初期化 3.34 Hydrationエラー対応② 3.76 Hydrationエラー対応③ 4.03 /admin修正方針 4.13 案1で修正 4.21 ロゴ生成 4.46 favicon生成 4.67 ヘッダーアイコン差し替え 4.72 コメントリアクション 4.92 エラー対応 5.06 投稿検索機能 5.25 初期データ自動生成 5.48 コメント数初期化修正 5.62 装飾モード追加 6.02 一覧HTML修正 6.25 一覧で装飾表示 6.36 コメントスレッド 6.74 メンション通知 7.25 スペース入りユーザー対応 7.56 @Admin通知調査 7.77 DM機能 9.49 おまけ：サービスロゴやfaviconの生成について painter - Owner’s Manual - Amp https://ampcode.com/manual#painter ampcodeは、画像生成の機能も提供されているので、実装しながら画像が欲しいなと思ったらその場で生成させることができるのも地味に便利だった。今の時代どこでも画像作れはするけど、開発する体験の中でロゴとかfaviconなどのアセットを一緒に生成できるのは嬉しい。 "},{"title":"AmpCodeの広告付き無料プランを試そうと思ったら1ヶ月近く待たされた話","permalink":"/posts/20260209_ampcode-free-waiting-1month/","date":"2026-02-09","summary":"2025年末くらいにXのポストで AmpCode というサービスを知った。 このサービスは、比較的珍しい「広告付き無料プラン（Amp Free と呼ばれてます）」があるAIコーディングエージェントで、無料でも最新のAIモデルを使える。\n最新のAIモデルを使える（2026年1月時点だと Claude Opus 4.5） 毎日 10$ 分のクレジットを付与される データは学習されない 広告が開発に関す …","tags":["ampcode","ai coding","free plan"],"content":"2025年末くらいにXのポストで AmpCode というサービスを知った。 このサービスは、比較的珍しい「広告付き無料プラン（Amp Free と呼ばれてます）」があるAIコーディングエージェントで、無料でも最新のAIモデルを使える。 最新のAIモデルを使える（2026年1月時点だと Claude Opus 4.5） 毎日 10$ 分のクレジットを付与される データは学習されない 広告が開発に関する広告なので地味に良い感じ（らしい） 私は普段そんなにがっつりAIを使うことはなく、寝る前の1-2時間でちょっと思いついたことを試す、くらいの用途でAIを使っていたので、これだと最新のモデルも使えるしめっちゃええやん！ということで早速登録してみました。 ただし、登録したものの、すぐ使えずに結局一ヶ月近く待つことになったので、その話をまとめます。 登録したけど Amp Free 使えなかった 登録してすぐ使えるかと思ったらそうじゃなかった。どうも最近スパムが増えているらしくて、AmpCode側のフィルターに引っかかったみたいで、人間であることを証明してください、みたいな状態になった。まあ仕方ないかと思って、用意されていたGoogleフォームに回答した。が、それでも全然使えるようにならなかった\u0026amp;hellip; （自分はGoogleアカウントでログインして登録しました！） Hello, still cannot try AMP free after sending email and filling the form. I have this amp account only, how can I convince you I am a human ;) pic.twitter.com/PPz9Q9Zjry \u0026amp;mdash; heddxh (@heddxh) January 12, 2026 同じ症状の人のPOST このGoogleフォームがちょっと面白くて、選択式の質問とかではなく、シンプルに「あなたが人間であることを証明する文章を書いてください」と書かれたフォームが用意されてるだけだった。どう書くのが正解なのか正直よく分からなかったけど、GitHubのアカウントがあることとか、他に必要なら追加で証明するので教えてね、みたいなことを書いた気がする。 で、送信して待った。待ったけど、何も起きない。数日とかではなく、1-2週間待っても音沙汰なし\u0026amp;hellip;。あれ、これ通らなかったってことか？と思いつつ、特に追加でできることもなく、そのまま放置気味になった。 他にできることはないか調査 しばらくして、もしかして同じ症状で突破した人がいるんじゃないかと思って調べてみたら、Redditの投稿を見つけた。 AMP Free is not available anymore? : r/AmpCode https://www.reddit.com/r/AmpCode/comments/1q44u00/comment/nxsm7zr/?context=3 内容的には「前は Amp Free が使えていたのに、急に使えなくなった」みたいな話で、コメントに「間違ってブロックしたかもしれないからメールして」と書いてあった。 自分はそもそも最初から使えていないので状況は違うけど、ダメ元でメールを送ってみた。\u0026amp;hellip;が、それも特に返信は来なかった。正直、この時点で8割くらいはもうスパム判定くらってて使えないのかもなーと諦めていた。 1ヶ月後にようやく使えるようになった ところが、2月に入ってから急にメールが来た。内容はシンプルで、チェックが終わったので使えるようになりました、という感じだった。どこの誰かもわからない自分に対しても丁寧にメールで返信してくれてありがとう！という気持ちで、早速ログインしてみたら無事に使えるようになっていた。 他にも使えないって言ってる人ちらほらいるようで、単純に順番にチェックされてるだけっぽいが、待つ側としてはブロックされてもう使えないのか、本当に待たされてるだけなのか分からず、モヤモヤしてしまった。 表示される広告について am i correct to think that @AmpCode free\u0026amp;#39;s ads are personalized based on my current session (or session histories)? the ads are lowkey useful pic.twitter.com/2qOyAadoCy \u0026amp;mdash; baggie (@baggiiiie) February 1, 2026 公式で言及されてるか不明だが、Amp Free で表示される広告は、どうもユーザーのセッション履歴に基づいてパーソナライズされているらしい。学習されてるように感じてる人もいるかもしれないが、今自分が興味がある技術的なトピックについて広告で情報提供が行われる、というのは体験としてとても良いと思った。 まとめ AmpCodeの広告付き無料プランを試そうと思ったら1ヶ月近く待たされた話でした。今は無事に使えるようになったので、色々試してまたネタを書こうと思います。 "},{"title":"BetterTouchTool: キーシーケンスによるスニペット入力機能が突然動作しなくなりOSアップデートで解決した..と思ったらただの勘違いだった話（解決編）","permalink":"/posts/20260207_btt-key-sequence-snippet-issue-solved/","date":"2026-02-07","summary":"はじめに BetterTouchTool: キーシーケンスによるスニペット入力機能が突然動作しなくなったが、OSアップデートで解決した話 | xshoji\u0026rsquo;s blog\nhttps://blog.xshoji.com/posts/20260117_btt-key-sequence-snippet-issue/ こちらで意気揚々と書いたブログの内容に関して、\nググっても解決できなかった！ …","tags":["BetterTouchTool","BTT","macOS","トラブルシューティング"],"content":"はじめに BetterTouchTool: キーシーケンスによるスニペット入力機能が突然動作しなくなったが、OSアップデートで解決した話 | xshoji\u0026amp;rsquo;s blog https://blog.xshoji.com/posts/20260117_btt-key-sequence-snippet-issue/ こちらで意気揚々と書いたブログの内容に関して、 ググっても解決できなかった！ OSアップデートが原因だった！！ AIに相談して解決の糸口が掴めた！！！ と散々書いてたんですが、数日後に、macOS 26 でもガッツリ再発して頭を抱える事態が発生しました\u0026amp;hellip; で、すぐChatGPTに泣きついて相談してみたんですが、惜しいところまで回答してくれるものの 結局解決には至りませんでした。確認コマンドやら、ここが怪しい！と教えてくれるんですが、そのコマンドが動かなかったりで、作業が発散していってしまう感じでした。 このため、結局自分でググってみることにしました。 いきなり解決 Key Sequences stopped working- can\u0026amp;rsquo;t even record - Bugs or Unexpected Behavior - BetterTouchTool Community https://community.folivora.ai/t/key-sequences-stopped-working-cant-even-record/43000/3 \u0026amp;hellip;はい、コミュニティの掲示板で、全く同じ事象の投稿を見つけました。 I now notice I have KeepassXC running asking for a password, so I exit it, now BTT shows no secure input, good start! key sequences working now 現在KeepassXCがパスワード入力を求めて起動していることに気づきました。これを終了したところ、BTTでは安全な入力項目が表示されなくなりました。良いスタートです！ そしてキーシーケンスが動作するようになりました！ これをみてハッとしたんですが、自分もまさに KeePassXC 使っていて、起動してるところでした。 で、 KeePassXC を終了したら、あっさりキーシーケンスが動作するようになりました!! この人も言ってますが、 Secure Input というキー入力をセキュアに扱う仕組みがmacOSにあり、これが有効になっているとBTTを含む \u0026amp;ldquo;キーシーケンスをトリガーに発動するアプリ\u0026amp;rdquo; 全般がシーケンスを読めなくなり動作しなくなるようです。 KeePassXC側でもIssueになってた Keepassxc 2.7.10 on macOS is often stuck in \u0026amp;ldquo;secure input\u0026amp;rdquo; mode · Issue #11906 · keepassxreboot/keepassxc https://github.com/keepassxreboot/keepassxc/issues/11906 ─ Steps to Reproduce I can reproduce the desired behavior, when I\u0026amp;rsquo;m editing a password in KeePassXC. But I can unfortunately not reproduce the unintended \u0026amp;ldquo;secure input\u0026amp;rdquo; when KeePassXC is not prompting passwords. I happens a few times a day. この問題、 KeePassXC 側でもIssueになっていたようで、ちょうどリリースノート見たら Release Release 2.7.11 · keepassxreboot/keepassxc https://github.com/keepassxreboot/keepassxc/releases/tag/2.7.11 ─ Fixes \u0026amp;hellip; macOS: Fix secure input getting stuck [#11928] やった！修正済みのようでした。 ということで、 KeePassXC を最新版にアップデートすれば良さそうです。スッキリしました。 まとめ 発端の不具合の事象からググり方が分からず解決できなかったのと、ChatGPTに相談でOSアップデートを試みて解消したのは事実でした。 ですが、もろもろガッツリ勘違いだった、というオチだったようです。 結局、コミュニティの掲示板で KeePassXC の Secure Input 干渉の不具合を発見し、アプリを終了したら即解決しました。また、 KeePassXC を最新版へのアップデートすることで根本的な問題を解消できることを発見しました。 トラブルシューティングでは、諦めず公式の issue や掲示板を漁るのを忘れないことが大事ですね。 あとは、ChatGPTとの壁打ちをもっと深めてれば、 Secure Input の話に辿り着けたかもしれない\u0026amp;hellip;うーん難しいですね。 "},{"title":"Zed: キーボードのみで矩形選択できるようにする設定","permalink":"/posts/20260128_zed-column-selection-keyboard-bindings/","date":"2026-01-28","summary":"普段、 VSCode でテキスト編集しているんですが、本当に若干ですが \u0026ldquo;もっさり\u0026rdquo; するんですよね。 私は普段 memo.txt と言うファイルにあらゆるメモを保存しているんですが、ちょっとしたメモを保存するのに VSCode を起動しようとすると、ほんの一瞬待たされるのでそこがストレスになっています。\nそこで、最近 Zed エディタを試しているんですが、 Zed は非常 …","tags":["zed","editor","column selection","keyboard bindings"],"content":"普段、 VSCode でテキスト編集しているんですが、本当に若干ですが \u0026amp;ldquo;もっさり\u0026amp;rdquo; するんですよね。 私は普段 memo.txt と言うファイルにあらゆるメモを保存しているんですが、ちょっとしたメモを保存するのに VSCode を起動しようとすると、ほんの一瞬待たされるのでそこがストレスになっています。 そこで、最近 Zed エディタを試しているんですが、 Zed は非常に軽量で起動も一瞬ですしサクサク動きます。 今回は、そんな Zed エディタでキーボードのみで矩形選択（カラム選択）できるようにする設定方法を紹介します。 やりたいこと 矩形選択とは こういうやつのことです。 どのEditorで染みついたのか忘れてしまったんですが、私は普段 Shift + Alt + ↑ : カーソルを矩形選択モードで上方向に伸ばす Shift + Alt + ↓ : カーソルを矩形選択モードで下方向に伸ばす という使い方をしていて、体がそれに慣れてしまっています。 ちなみに VSCode だと cursorColumnSelectUp cursorColumnSelectDown がこれらの操作に対応するショートカット設定になります。 Zed で矩形選択（カラム選択）する設定 Add support for column selection mode · Issue #7215 · zed-industries/zed https://github.com/zed-industries/zed/issues/7215 こちらの Issue にヒントがありました。 具体的には以下のように設定することで、 VSCode と同じキーボードショートカットで矩形選択できるようになりました。 Zed -\u0026amp;gt; Settings -\u0026amp;gt; Open Keymap File を開き、以下のように設定を追加します。 ※ 私の環境では Zed 0.218.6 で動作することを確認しています。 ... { \u0026amp;#34;context\u0026amp;#34;: \u0026amp;#34;Editor\u0026amp;#34;, \u0026amp;#34;bindings\u0026amp;#34;: { \u0026amp;#34;alt-shift-up\u0026amp;#34;: \u0026amp;#34;editor::AddSelectionAbove\u0026amp;#34;, \u0026amp;#34;alt-shift-down\u0026amp;#34;: \u0026amp;#34;editor::AddSelectionBelow\u0026amp;#34;, }, }, ... ググっても意外と出てこなくて、AIに聞いても「それはできません」と言われてしまったので、本当に無理なのか自力で調べたところ、設定できたので今回記事にしてみました。 同じ悩みを抱える方の参考になれば幸いです。 参考情報 Keybindings | Zed Code Editor Documentation https://zed.dev/docs/key-bindings "},{"title":"OpenCode の GitHub Copilot 連携機能が正式サポートされたので仕組みを再確認してみた","permalink":"/posts/20260118_opencode-github-copilot-official-integration/","date":"2026-01-18","summary":"以前\nOpenCode の GitHub Copilot 連携機能の仕組みを読み解く（注意点あり） | xshoji\u0026rsquo;s blog\nhttps://blog.xshoji.com/posts/20260106_opencode-github-copilot-integration-spec/ こちらで記事にした OpenCode の GitHub Copilot 連携機能ですが …","tags":["opencode","github copilot","oauth"],"content":"以前 OpenCode の GitHub Copilot 連携機能の仕組みを読み解く（注意点あり） | xshoji\u0026amp;rsquo;s blog https://blog.xshoji.com/posts/20260106_opencode-github-copilot-integration-spec/ こちらで記事にした OpenCode の GitHub Copilot 連携機能ですが、2026年1月16日に公式にサポートされたと発表がありました。 OpenCode can now officially be used with your Github Copilot subscription with the $39 pro+ subscription you get access to the best coding models wonderful to see them support open source and user choice of tooling in this way pic.twitter.com/BUH1JtBF32 \u0026amp;mdash; OpenCode (@opencode) January 15, 2026 Your @GitHub Copilot subscription can now officially be used with @OpenCode pic.twitter.com/f5aJtVWhG6 \u0026amp;mdash; Jared Palmer (@jaredpalmer) January 15, 2026 ということで、改めて OpenCode の GitHub Copilot 連携機能が以前とどう変わったのか再確認してみました。 公式サポート前の仕組みのおさらい 過去記事でも書きましたが、以前の OpenCode の GitHub Copilot 連携機能は「 GitHub Copilot Plugin 」のクライアントIDを \u0026amp;ldquo;なりすまし的に\u0026amp;rdquo; 利用して、ユーザーの GitHub Copilot の機能にアクセスしていました。 過去記事にも書きましたが、 本来であれば、OpenCode のような サードパーティ製アプリは、自分たちで独自に OAuth アプリケーションを GitHub 上に登録し、そのアプリケーションの Client ID を使って OAuth の認可を行うべきです。 もし公式サポートされたのであれば、 OpenCode の OAuth アプリが GitHub 上に正式登録されており、それに対してユーザー（私たち）が認可を与える形になるはずです。 実際に確認してみました まずはコードレベルで確認 まずは、コードレベルで確認してみました。 feat: official copilot plugin by rekram1-node · Pull Request #8393 · anomalyco/opencode https://github.com/anomalyco/opencode/pull/8393/files#diff-020125865630f1b8d13ae8f34871a89c49b32e407159ea0b43bfdea93f19e841R5 こちらが正式サポートのPRです。みてみると、クライアントIDが以前の GitHub Copilot Plugin のものから別のIDに変更されていることがわかります。 before/after Client ID before Iv1.b507a08c87ecfe98 after Ov23li8tweQw6odWQebz この Ov23li8tweQw6odWQebz という Client ID が OpenCode の OAuth アプリケーションのものの可能性が高いです。 連携してみた では、実際に OpenCode と GitHub Copilot を連携してみます。 ここで注意が必要なのは、この正式サポートされた GitHub Copilot 連携機能は OpenCode v1.1.21 から利用可能になっています。これよりも古いバージョンの OpenCode だと、以前の記事にある非公式な方法で GitHub Copilot 連携が行われるので注意してください。 Comparing v1.1.20\u0026amp;hellip;v1.1.21 · anomalyco/opencode https://github.com/anomalyco/opencode/compare/v1.1.20...v1.1.21 ─ feat: official copilot plugin (#8393) rekram1-node authored 私も古いバージョンの OpenCode を使っていたので、まずは最新版にアップデートしました。 \u0026amp;hellip;が、ここでこの記事の話とは全く関係のないところでちょっと躓きました。 $ opencode upgrade ... █▀▀█ █▀▀█ █▀▀█ █▀▀▄ █▀▀▀ █▀▀█ █▀▀█ █▀▀█ █░░█ █░░█ █▀▀▀ █░░█ █░░░ █░░█ █░░█ █▀▀▀ ▀▀▀▀ █▀▀▀ ▀▀▀▀ ▀ ▀ ▀▀▀▀ ▀▀▀▀ ▀▀▀▀ ▀▀▀▀ ┌ Upgrade │ ● Using method: brew │ ● From 1.1.14 → 1.1.23 │ ◇ Upgrade complete │ └ Done $ opencode --version 1.1.14 opencode upgrade コマンドがバグってるのか、最新版にアップデートしたつもりが、なぜか古いバージョンのままで更新できませんでした。仕方ないので Homebrew 経由で再インストールして最新版にしました。 [01-16 10:44:08] macbookpro test$ brew install anomalyco/tap/opencode opencode 1.1.14 is already installed but outdated (so it will be upgraded). ==\u0026amp;gt; Fetching downloads for: opencode ✔︎ Formula opencode (1.1.23) Verified 35.3MB/ 35.3MB ==\u0026amp;gt; Upgrading anomalyco/tap/opencode 1.1.14 -\u0026amp;gt; 1.1.23 🍺 /usr/local/Cellar/opencode/1.1.23: 4 files, 103.7MB, built in 4 seconds ==\u0026amp;gt; Running `brew cleanup opencode`... Disable this behaviour by setting `HOMEBREW_NO_INSTALL_CLEANUP=1`. Hide these hints with …"},{"title":"BetterTouchTool: キーシーケンスによるスニペット入力機能が突然動作しなくなったが、OSアップデートで解決した話","permalink":"/posts/20260117_btt-key-sequence-snippet-issue/","date":"2026-01-17","summary":" [ ! ] 2026-02-07(土) 追記\nBetterTouchTool: キーシーケンスによるスニペット入力機能が突然動作しなくなりOSアップデートで解決した..と思ったらただの勘違いだった話（解決編） | xshoji\u0026rsquo;s blog …","tags":["BetterTouchTool","BTT","macOS","トラブルシューティング"],"content":" [ ! ] 2026-02-07(土) 追記 BetterTouchTool: キーシーケンスによるスニペット入力機能が突然動作しなくなりOSアップデートで解決した..と思ったらただの勘違いだった話（解決編） | xshoji\u0026amp;rsquo;s blog https://blog.xshoji.com/posts/20260207_btt-key-sequence-snippet-issue-solved/ で本件の根本解決しました。 こちらの記事の内容は完全に勘違いだったようです。が、ネタとして残しておきます。 はじめに 普段BTTを愛用していて、キーシーケンスによるスニペット入力をよく使います。 これは、たとえば ;now とタイプすると 2026-01-17(土) 02:36:13 と展開される といったものです。 こういった単純なスニペット展開から、最近だとAIへのプロンプトを呼び出したり大変便利です。 そんなキーシーケンスによるスニペット入力機能ですが、数日前まで普通に使えていたのに、ある日突然動かなくなりました。 設定は一切変えていないし、macOSも普段どおり使っているだけです。それなのに、トリガーが一切発火しない。 最初は「まあBTTだし、たまにあるよね」くらいの気持ちで調査を始めたのですが、結果的にこれはググっても、SNSを見ても、ほぼ辿り着けない系の不具合でした。 この記事では最終的にどうやって答えに辿り着いたのか、その流れをネタとして書き残しておきます。 数日前まで動いていた機能が、突然死にました 使えなくなったのは、BTTの Keyboard Sequence トリガー を使ったスニペット機能です。 ある日（というか今日）、いきなり動作しなくなりました。 BTTいじってないし、文字通り「何もしてないのに動かなくなりました！！」状態でした。 まずはBTT側の不具合を疑ってみた 真っ先に疑ったのはBTT自身の不具合です。というのも、BTTって結構バグること多くて、マイナーアップデートもかなり頻繁にあるので、またそれかなー程度に思ってました。なので 最新バージョンへアップデート 数バージョン前へロールバック 再起動 設定のON/OFF あたり一通り試してみたのですが、全部ダメでした。 この段階で「BTTのバグっぽくないのでは？」という感触を得ました。 （特に、問題なく動作していたバージョンにロールバックしてもダメだったのが大きかった） 公式フォーラムやXを漁るが、誰も騒いでいない 次に念の為、以下を覗いて情報収集してみました。 BetterTouchTool Community https://community.folivora.ai/ x.com - search https://x.com/search?q=better%20touch%20tool\u0026amp;src=typed_query ですが、全然同じ症状で困っている人が見当たりませんでした。 BTTが壊れているなら、もっと騒ぎになっていてもよさそうなのに、そしてロールバックしてもダメだったことと総合的に考えて、自分環境固有の問題っぽいな、と思い始めたのでした。 現象をちゃんと見ることにした ここで方針を変え、「直す」よりも「何が起きているか」を見ることにしてみました。 で、BTTの Keyboard Sequence の設定画面 を開き、実際にキー入力をしてみて気づいたのですが、 なんと設定の時点でキーが認識されないのです。 これはつまり、BTTがキーボードからの入力をそもそも受け取れていない、ということを意味します。 \u0026amp;hellip;ただ、さらによく観察すると、一部のキーは認識されるというとても奇妙な状態であることがわかりました。 a, b, c, 1, 2, 3 などのキー → 無反応 Shift, Control, Command, Tab など → 反応する つまり、修飾キーだけは認識されているという状態です。 この時点で キーボード自体の故障ではない（当たり前ですが） BTTも一部のキー入力は受け取れている ということは確定しました。 ググるのを諦めて、ChatGPTに投げた 正直、この状態は症状がニッチすぎるのと、何てググれば良いのかもよくわからない状態になっていたので、これまでの観測結果をそのままChatGPTに投げてみました。 AIと壁打ちの末、「macOSのセキュリティアップデート」が原因では？という話になり、ChatGPTが以下の仮説を出してきました。 macOS側が 通常キーのイベントだけを落としている 修飾キーが通るのは、OS設計上の都合 直前に行った macOS Sonoma のセキュリティアップデートが怪しい 言ってなかったんですが、直近macOSのセキュリティのパッチが来てたので、 Sonoma のアップデートを当てたばかりだったんですよね。自分はそこ関係してるとは全く思わなかったので、とりあえず ほーん、くらいに思い一旦休憩しました。 乗り気ではなかったが、macOS 26 に上げてみた 1時間くらい経ったタイミングで、もう打つ手もないし、OSアップデートするかー、と思い立ち、 macOS 26 に上げることにしました。 そもそもアップデートしてなかった理由は 自分のPCが最後のIntel Mac機（2020年製）なのでちゃんと動作するか不安 PCのスペックが高くないのでシンプルに重そう 安定性を優先したい、メジャーアップデート直後だし という感じで、もう少し様子見してからあげようと思ってたので、渋ってた感じでした。 ですが、OSが原因なら、上げるしか検証手段がないという結論になり、 macOS Sonoma → macOS 26 にアップデート。 その結果\u0026amp;hellip;. \u0026amp;ldquo;完全復活\u0026amp;rdquo; しました🎊 BTTのキーボードシーケンスも、スニペットも、何事もなかったかのように動き出したのでした。 ちなみに問題があった時のBTTやmacOSのバージョンは以下の通りです。 BTT: 6.011 macOS: Sonoma 14.8.3 教訓：この問題は「検索」では解けなかった 今回遭遇した事象は、ググってもフォーラムを見てもSNSを巡回してもほぼ確実に解決できない類の不具合でした。 というのも、発生条件がだいぶニッチですし、騒がれるほどの母数がないので調べようがない感じだったんですよね。 ChatGPTに相談してからは 観測事実を整理 可能性を一つずつ潰し 「どこまでがアプリの責任か」を切り分け 最終的に OSが原因だと腹落ちする というところまで辿り着くことできま、マジで助かりました。 おわりに 情報収集にAIを使うのも便利ですが、問題の切り分けや解決策の壁打ち相手にAIを使うことで、解決策が転がってないような課題でも比較的スムーズに解決できることを改めて実感しました。 BTTに限らず、同じように「理由はわからないけど壊れた」という状況にハマった人の参考になれば幸いです。 "},{"title":"Go 標準の flag パッケージのテクニック集その2: ロングオプションへ対応する","permalink":"/posts/20260112_golang-flag-pretty-usage-with-long/","date":"2026-01-12","summary":"Go 標準の flag パッケージのテクニック集その1: Usageを綺麗に整形して見やすくする | xshoji\u0026rsquo;s blog の続きです。前回は、Go 標準の flag パッケージで Usage を綺麗に整形する方法を紹介しました。 Usage は見やすくなったのですが、次の要件として、ロングオプションを扱いたい、というのがあります。\nUnix系のコマンドラインツールでは、一般的に …","tags":["golang","go","flag","cli","command-line","usage"],"content":"Go 標準の flag パッケージのテクニック集その1: Usageを綺麗に整形して見やすくする | xshoji\u0026amp;rsquo;s blog の続きです。前回は、Go 標準の flag パッケージで Usage を綺麗に整形する方法を紹介しました。 Usage は見やすくなったのですが、次の要件として、ロングオプションを扱いたい、というのがあります。 Unix系のコマンドラインツールでは、一般的にショートオプション（ -f のような1文字のオプション）とロングオプション（ --file のような複数文字のオプション）の両方をサポートしていることが多いです。 Go 標準の flag パッケージは、 任意の文字列をフラグ名として定義できるので、ショートオプションとロングオプションの両方を実装上定義することは可能ですが、それらが同じ意味のオプションであることが Usage からは伝わりづらいので、そのままではとても使えません。 前回紹介した有名な spf13/cobra や urfave/cli といったフレームワークを使えば簡単に実現できるのですが、 今回はあえて main.go のみで実装することにこだわりたかったため、Go 標準の flag パッケージだけでロングオプションを扱えるようにする方法を試行錯誤してみました。 多少複雑ですが、実用的な実装ができたので、今回はその実装方法について紹介したいと思います。 注意: この記事で紹介するスニペットは Go 1.18以上（Genericsを使用するため） が必要です そもそもの問題点 通常、Go 標準の flag パッケージを使ってコマンドライン引数を定義する場合、以下のようにします。 var filePath = flag.String(\u0026amp;#34;f\u0026amp;#34;, \u0026amp;#34;\u0026amp;#34;, \u0026amp;#34;Path to the file\u0026amp;#34;) この場合、 -f オプションでファイルパスを指定できるようになります。 しかし、これだけではロングオプション（ --file ）をサポートすることはできません。 これに対して、 flag パッケージは、以下のように複数の名前で同じ変数を定義することができます。 var filePath = flag.String(\u0026amp;#34;f\u0026amp;#34;, \u0026amp;#34;\u0026amp;#34;, \u0026amp;#34;Path to the file\u0026amp;#34;) flag.StringVar(filePath, \u0026amp;#34;file\u0026amp;#34;, \u0026amp;#34;\u0026amp;#34;, \u0026amp;#34;Path to the file\u0026amp;#34;) このようにすると、 -f と --file の両方で同じ変数に値を設定できるようになります。 しかし、これだけでは Usage 出力時に両方のオプションが別々に表示されてしまい、同じ意味のオプションであることが伝わりづらいです。 Usage of ./myapp: -f string Path to the file -file string Path to the file まぁ、これはオプションが1つなのでまだ良いんですが、複数オプションになるとかなり見づらくなります。 前回紹介した、 Custom Usage での表示を踏襲し、以下のように表示できると理想的だと思います。 Usage: myapp [options] Options: -f, --file string Path to the file ロングオプションの利点 次に、そもそもロングオプションをサポートする必要ってあるの？ という点について私の考えをまとめておきます。 ロングオプションをサポートすると、シンプルに「オプション名が直感的に分かりやすい」という利点が生まれます。 例: -f よりも --file-path の方がオプションの意味が直感的 この結果、業務でコマンドラインツールを使う際に以下のようなメリットがあります。 実行結果の証跡をあとから見たときに、オプションの意味が分かりやすい オプションの値を変えて実行する際に help を見なくても意味を推測しやすくなる (最近だと) AIに実行させる場合にオプションの意味が伝わりやすい\u0026amp;hellip;かもしれません ということで、もし手間でなければなるべくロングオプションもサポートしておくと良いのかな、と思っています。 今回作ったもの 前回の記事で紹介した Custom Usage を基に、ロングオプションのサポートを追加したよりリッチなスニペットを考えました。 今回紹介するスニペットを使うと、以下のように main.go のみでも良い感じにロングオプションをサポートできるようになります。 [01-12 02:53:17] macbookpro sample$ ls -al total 8 drwxr-xr-x 3 user wheel 96 Jan 12 02:53 . drwxrwxrwt 15 root wheel 480 Jan 12 02:53 .. -rw-r--r-- 1 user wheel 3872 Jan 12 02:50 main.go [01-12 02:53:18] macbookpro sample$ go run main.go -h Usage: main --file-path \u0026amp;lt;string\u0026amp;gt; [OPTIONS] Description: A sample command demonstrating full template usage in Go CLI applications. Options: -f, --file-path \u0026amp;lt;string\u0026amp;gt; (required) File path -d, --debug Debug mode -l, --line-index \u0026amp;lt;int\u0026amp;gt; Index of line (default 10) -u, --url \u0026amp;lt;string\u0026amp;gt; URL (default https://httpbin.org/get) -w, --wait-seconds \u0026amp;lt;duration\u0026amp;gt; Duration of wait seconds (e.g., 500ms, 3s, 2m) (default 1s) 依存なしの main.go のみで実装してる割には、かなり本格的なCLIっぽいUsage表示ができているのでは、と思います。 前回紹介した Custom Usage で工夫した以下の点 正確な実行バイナリ名を表示する コマンドの説明文の表示 オプション一覧が一行で表示される 必須のオプションがどれか分かりやすい（上位に表示される） は当然踏襲していて、それに加えてロングオプションもサポートできています。 また、細かい点ですが、1行目の Usage 表示で、必須オプションの指定が例示されるようになっていて、よりユーザーフレンドリーな Usage を表示できるようになっています。 その他の工夫として、ロングオプションが加わるとオプション列の横幅が動的に変わるため、 Usage 出力時にオプシ …"},{"title":"VSCode: Copilot Chat のペインで上下キーでの履歴移動とEnterキーでの送信を無効化して使いやすくする","permalink":"/posts/20260108_vscode-copilot-chat-pane-improvement/","date":"2026-01-08","summary":"VSCodeの Copilot Chat のペインでAIへ指示する際、イラっとする動きをすることが２点ほどありました。具体的には\n上下でカーソル移動する際に、1行目で↑キーを押すと前に送信した文章が表示されてしまう（履歴移動になる） まだ入力中なのに間違えてEnterで送信してしまう という点です。今回はこれらの解消方法を見つけたので紹介します。\n","tags":["vscode","copilot chat","chat","ai","shortcut"],"content":"VSCodeの Copilot Chat のペインでAIへ指示する際、イラっとする動きをすることが２点ほどありました。具体的には 上下でカーソル移動する際に、1行目で↑キーを押すと前に送信した文章が表示されてしまう（履歴移動になる） まだ入力中なのに間違えてEnterで送信してしまう という点です。今回はこれらの解消方法を見つけたので紹介します。 上下キーでの履歴移動を無効化する Here are the keybindings to disable it in chat but keep it elsewhere https://github.com/microsoft/vscode/issues/282902#issuecomment-3644365381 にある通り、以下の設定を keybindings.json に追加します。 ( keybindings.json の開き方は、 過去記事 に手順を載せてるので参考にしてみてください) { \u0026amp;#34;command\u0026amp;#34;: \u0026amp;#34;-history.showPrevious\u0026amp;#34;, \u0026amp;#34;key\u0026amp;#34;: \u0026amp;#34;up\u0026amp;#34; }, { \u0026amp;#34;command\u0026amp;#34;: \u0026amp;#34;-history.showNext\u0026amp;#34;, \u0026amp;#34;key\u0026amp;#34;: \u0026amp;#34;down\u0026amp;#34; }, { \u0026amp;#34;command\u0026amp;#34;: \u0026amp;#34;history.showPrevious\u0026amp;#34;, \u0026amp;#34;key\u0026amp;#34;: \u0026amp;#34;up\u0026amp;#34;, \u0026amp;#34;when\u0026amp;#34;: \u0026amp;#34;historyNavigationBackwardsEnabled \u0026amp;amp;\u0026amp;amp; historyNavigationWidgetFocus \u0026amp;amp;\u0026amp;amp; !isComposing \u0026amp;amp;\u0026amp;amp; !suggestWidgetVisible \u0026amp;amp;\u0026amp;amp; !inChat\u0026amp;#34; }, { \u0026amp;#34;command\u0026amp;#34;: \u0026amp;#34;history.showNext\u0026amp;#34;, \u0026amp;#34;key\u0026amp;#34;: \u0026amp;#34;down\u0026amp;#34;, \u0026amp;#34;when\u0026amp;#34;: \u0026amp;#34;historyNavigationForwardsEnabled \u0026amp;amp;\u0026amp;amp; historyNavigationWidgetFocus \u0026amp;amp;\u0026amp;amp; !isComposing \u0026amp;amp;\u0026amp;amp; !suggestWidgetVisible \u0026amp;amp;\u0026amp;amp; !inChat\u0026amp;#34; } Enterで送信を無効化する（Cmd + Enterで送信するようにする） https://github.com/orgs/community/discussions/86624#discussioncomment-12870557 にある回答を参考に、以下の設定を keybindings.json に追加します。 // Disable Enter key to submit in VSCode Copilot Chat input box { \u0026amp;#34;key\u0026amp;#34;: \u0026amp;#34;cmd+enter\u0026amp;#34;, \u0026amp;#34;command\u0026amp;#34;: \u0026amp;#34;workbench.action.chat.submit\u0026amp;#34;, \u0026amp;#34;when\u0026amp;#34;: \u0026amp;#34;chatInputHasText \u0026amp;amp;\u0026amp;amp; inChatInput \u0026amp;amp;\u0026amp;amp; !chatSessionRequestInProgress \u0026amp;amp;\u0026amp;amp; !withinEditSessionDiff\u0026amp;#34; }, { \u0026amp;#34;key\u0026amp;#34;: \u0026amp;#34;enter\u0026amp;#34;, \u0026amp;#34;command\u0026amp;#34;: \u0026amp;#34;-workbench.action.chat.submit\u0026amp;#34;, \u0026amp;#34;when\u0026amp;#34;: \u0026amp;#34;chatInputHasText \u0026amp;amp;\u0026amp;amp; inChatInput \u0026amp;amp;\u0026amp;amp; !chatSessionRequestInProgress \u0026amp;amp;\u0026amp;amp; !withinEditSessionDiff\u0026amp;#34; }, まとめ これで、イライラする動作を解消でき、快適に Copilot Chat に指示を出せるようになりました!! "},{"title":"OpenCode の GitHub Copilot 連携機能の仕組みを読み解く（注意点あり）","permalink":"/posts/20260106_opencode-github-copilot-integration-spec/","date":"2026-01-07","summary":" [ ! ] 2026-01-16(金) 追記\nOpenCode on X: \u0026ldquo;OpenCode can now officially be used with your Github Copilot subscription \u0026hellip;\u0026rdquo;\nhttps://x.com/opencode/status/2011790750543983072 にある通り公式に …","tags":["opencode","github copilot","oauth","zed"],"content":" [ ! ] 2026-01-16(金) 追記 OpenCode on X: \u0026amp;ldquo;OpenCode can now officially be used with your Github Copilot subscription \u0026amp;hellip;\u0026amp;rdquo; https://x.com/opencode/status/2011790750543983072 にある通り公式に GitHub Copilot 連携がサポートされたようです。 こちらの記事は、公式連携がサポートされる前にどのように OpenCode が GitHub Copilot 連携を実現していたのかの調査の記録として残しておきます。 はじめに Claude Code の OSS 版と言われている OpenCode | The open source AI coding agent https://opencode.ai/ が話題になっています。 私は普段 GitHub Copilot を利用しているのですが、この OpenCode は GitHub Copilot との連携に対応しています。 \u0026amp;hellip;となると、 Claude Code を使わずとも、 OpenCode を使えば、追加料金なしで Claude Code っぽい環境を手に入れられるのでは？と思い、興味が湧きました。 ただ、利用する前に一点気になることがありました。 それは、 GitHub Copilot って 3rd パーティ製アプリに対して Copilot を使った操作の API を公開してない認識だったので、どのように連携してるんだろう？という点でした。 この部分について調べてみたところ、興味深い点と少し注意が必要な状況であることがわかったので、 今回はその内容について共有したいと思います。 OpenCode の GitHub Copilot 連携の仕組み OpenCode の GitHub Copilot 連携の仕組みを理解するために、まずは OpenCode のソースコードを確認してみました。 以下のリポジトリに、 GitHub Copilot 連携に関するコードがありました。 L5 - opencode-copilot-auth/index.mjs - anomalyco/opencode-copilot-auth https://github.com/anomalyco/opencode-copilot-auth/blob/main/index.mjs#L5 ここを見ると、以下のような仕組みで GitHub Copilot との連携を実現していることが分かります。 項目 説明 連携方式 OAuth 2.0 Device Flow による認可 OAuth Client ID Iv1.b507a08c87ecfe98 次に、連携の仕組みもう少し深く知るために、この Client ID の実態が何なのかを少し詳しく調べてみました。 Client ID: Iv1.b507a08c87ecfe98 の正体を調べる 調べてみたところ、面白いことがわかりました。 この Client ID: Iv1.b507a08c87ecfe98 の実体は Connection with GitHub Copilot Plugin https://github.com/settings/connections/applications/Iv1.b507a08c87ecfe98 こちらの GitHub提供の公式アプリの Client ID と一致しているようです。 この GitHub Copilot Plugin というのは、 Visual Studio Code や JetBrains IDE 向けの公式プラグインが利用しているアプリケーションです。 OAuthに詳しい方なら、「あれ？」と思うかもしれません。 本来であれば、OpenCode のような 3rd パーティ製アプリは、自分たちで独自に OAuth アプリケーションを GitHub 上に登録し、そのアプリケーションの Client ID を使って OAuth の認可を行うべきです。 ただし、OpenCode は、現状この GitHub Copilot Plugin の Client ID を流用し、あたかも自信が公式の GitHub Copilot Plugin であるかのようにユーザーに認可画面を表示し、 OAuth の認可を行っているようです。 GitHub.com の Applications を見ると、GitHub Copilot Plugin は以下のように表示されているので、 OpenCode から利用する場合の実情と比較すると乖離があるように見えますね。 具体的にどんな問題があるのか？注意点について考える 大前提として、この方法で OAuth の認可を行うこと自体は技術的には可能ですし、トークンが第三者に渡ったり、悪用されてしまうような心配は基本的にはありません。 ただし、以下のような注意点や問題が発生する可能性があります。 Authorized OAuth Apps に認可したつもりの「 OpenCode 」のアプリが表示されない GitHub Copilot Plugin の Client ID を流用しているため、システム上はこの「 GitHub Copilot Plugin 」という GitHub.com 公式のツールに対して認可を与えたことになり、ユーザーが認可したはずの OpenCode のアプリは存在しない状態になります OpenCode への認可を単体で取り消せない Authorized OAuth Apps に OpenCode のアプリが存在しないため、認可を取り消したい場合は、 GitHub Copilot Plugin 全体の認可を取り消す必要があります GitHub.com の管理画面上で、 OpenCode へ認可を与えていることが把握できない そもそも GitHub.com 側のポリシーに準拠してるのか曖昧 これいいんだっけ？について redditで議論されてるスレ を見つけました このため、 2026-01-07時点では、 OpenCode の GitHub Copilot 連携機能を利用する際には \u0026amp;ldquo;GitHub Copilot Plugin\u0026amp;rdquo; という GitHub 公式アプリに対して認可を与えた扱いになる という点を意識して利用する必要がありそうです。 そもそもなぜ3rdパーティ製ツールは独自の GitHub Apps を用意しないのか これは、 Copilot のスコープを要求する GitHub Apps を作成しようとするとすぐ気づけるのですが、 一般ユーザーは、 GitHub Apps を作成する際の Permission として、 Copilot 関連の機能をフルで使う権限を選択できないようになっています。 OAuth Apps も同様で、Coplot に関するスコープは公開されていません。 Scopes for …"},{"title":"Go 標準の flag パッケージのテクニック集その1: Usageを綺麗に整形して見やすくする","permalink":"/posts/20260103_golang-flag-pretty-usage/","date":"2026-01-03","summary":"業務でちょっとした検証用のツールや、調査用のコマンドラインアプリケーションを Go 言語で作成することがよくあります。 基本自分しか使わないのですが、何かきっかけでスクリプトを他の人に配ることもあり、このとき main.go のみで完結するようにしておくと、人に配るときや何らかの証跡と一緒に残しておく際もテキストファイル一つ渡せば済むので大変便利です。 また、配布先の人がビルドする時もトラブルが少 …","tags":["golang","go","flag","cli","command-line","usage"],"content":"業務でちょっとした検証用のツールや、調査用のコマンドラインアプリケーションを Go 言語で作成することがよくあります。 基本自分しか使わないのですが、何かきっかけでスクリプトを他の人に配ることもあり、このとき main.go のみで完結するようにしておくと、人に配るときや何らかの証跡と一緒に残しておく際もテキストファイル一つ渡せば済むので大変便利です。 また、配布先の人がビルドする時もトラブルが少ないです。 このため、外部のライブラリが必ず必要という状況でない限りは、できるだけ Go 標準ライブラリだけでツールを作成するようにしています。 ただ、Go 標準の flag パッケージはコマンドライン引数のパースを簡単に実装できる反面、 Usage の出力があまり綺麗ではなかったり、ロングオプションを扱うのが難しいなど色々使い勝手が悪い部分があります。 先ほど説明した通り、 main.go のみで実装することにこだわりたかったため、これまで、 spf13/cobra や urfave/cli のような外部ライブラリを使わずに、どうにかして Usage を綺麗にしたり ロングオプションを扱えるようにしたりできないか試行錯誤したので、その実装方法について何回かに分けて紹介したいと思います。 今回は「 Usage を綺麗に整形して見やすくする 」方法について紹介します。 ここで紹介する方法（以降、呼びやすさのために「 Custom Usage 」と表現します）を使うと、標準の flag パッケージだけで以下のような綺麗な Usage を出力できるようになります。 $ go run main.go -h Usage: main [OPTIONS] Description: A sample command demonstrating simple template usage in Go CLI applications. Options: -f \u0026amp;lt;string\u0026amp;gt; (required) File path -d Debug mode -l \u0026amp;lt;int\u0026amp;gt; Index of line (default 10) -u \u0026amp;lt;string\u0026amp;gt; URL (default \u0026amp;#34;https://httpbin.org/get\u0026amp;#34;) -w \u0026amp;lt;duration\u0026amp;gt; Duration of wait seconds (e.g., 1s, 500ms, 2m) (default 1s) Go 標準の flag パッケージだけにしては結構見やすくなっているのではないでしょうか？ 興味があれば、ぜひ詳細を読んでみてください。 Custom Usage で見やすくしてるポイント 改めて flag デフォルトの Usage Custom Usage の違いを見てみます。 Before: flag デフォルトの Usage $ go run main.go -h Usage of /var/folders/vv/fc_khb3904d2d0_rz86jxhv00000gn/T/go-build1709560788/b001/exe/main: -d Debug mode -f string (required) File path -l int Index of line (default 10) -u string URL (default \u0026amp;#34;https://httpbin.org/get\u0026amp;#34;) -w duration Duration of wait seconds (e.g., 1s, 500ms, 2m) (default 1s) After: Custom Usage $ go run main.go -h Usage: main [OPTIONS] Description: A sample command demonstrating simple template usage in Go CLI applications. Options: -f \u0026amp;lt;string\u0026amp;gt; (required) File path -d Debug mode -l \u0026amp;lt;int\u0026amp;gt; Index of line (default 10) -u \u0026amp;lt;string\u0026amp;gt; URL (default \u0026amp;#34;https://httpbin.org/get\u0026amp;#34;) -w \u0026amp;lt;duration\u0026amp;gt; Duration of wait seconds (e.g., 1s, 500ms, 2m) (default 1s) 標準の flag パッケージの Usage は、フラグの名前と説明文が揃っておらず若干見づらくないですか？自分はここが結構気になってしまって、今回紹介する Custom Usage を作成しました。 では、Custom Usage で見やすくしているポイントを具体的に見ていきます。 正確な実行バイナリ名を表示する $ go run main.go -h Usage: main [OPTIONS] ... 通常 Go の flag パッケージを使うと、 Usage 出力時に Usage of {os.Args[0]} のような仕様で文字列が表示されます。 この os.Args[0] は実行したコマンドラインの最初の引数、つまり実行バイナリ名が通常入るのですが、厳密にいうと実行方法によっては実行されたバイナリ名にならないことがあります。 例えばシェルスクリプト等の中で exec -a \u0026amp;quot;hoge\u0026amp;quot; ./mycli ... のようにプロセス名を指定して呼び出した場合や、シンボリックリンク経由で実行した場合などです。 こういった場合でも正確な実行バイナリ名を表示するために、 Custom Usage では os.Executable() を使って実行バイナリのパスを取得し、 filepath.Base() でファイル名だけを抽出して表示しています。 これにより、どのような実行方法であっても正確な実行バイナリ名がUsageに表示されるようになります。 コマンドの説明文の表示 Description: A sample command demonstrating simple template usage in Go CLI applications. ここは好みの問題かもしれませんが、Descriptionがあるだけで一気に \u0026amp;ldquo;ちゃんとしたツール感\u0026amp;rdquo; が出るので、私はいつもコマンドのディスクリプションを表示するようにしてます。 オプション一覧が一行で表示される 今回紹介する Custom Usage の一番の売りがここなんですが、オプション一覧がライブラリを使用したかのように一行で綺麗に表示されるようになります。 Options: -f \u0026amp;lt;string\u0026amp;gt; (required) File path -d Debug mode -l \u0026amp;lt;int\u0026amp;gt; Index of line (default …"},{"title":"BetterTouchTool: グローバルなキーボードショートカットで固定のテキストファイルをVSCodeで開けるようにする","permalink":"/posts/20251231_btt-open-vscode-shortcut-constant-text/","date":"2025-12-31","summary":"Macを使い始めた頃から、 BetterTouchTool (BTT) をフル活用していて、これなしでは生きていけない体になっています。色々カスタマイズして使ってますが、今回はグローバルなキーボードショートカットで特定のテキストファイルをVisual Studio Codeで開けるようにする方法を紹介します。\nこれ、何に使うの？って話なんですが、私はいつもデスクトップに memo.txt というフ …","tags":["bettertouchtool","btt","vscode","shortcut","applescript"],"content":"Macを使い始めた頃から、 BetterTouchTool (BTT) をフル活用していて、これなしでは生きていけない体になっています。色々カスタマイズして使ってますが、今回はグローバルなキーボードショートカットで特定のテキストファイルをVisual Studio Codeで開けるようにする方法を紹介します。 これ、何に使うの？って話なんですが、私はいつもデスクトップに memo.txt というファイルを置いておいて、そこにちょっとしたメモを書いたり、文章の調整や頭の中を整理したりするために使っていて、頻繁に参照/書き込みします。いつもはこのファイルを開きっぱなしにしておいてアプリ切り替えでウィンドウをアクティブにする方法だったのですが、ふとBTT使えばグローバルショートカットでどこからでも簡単に開けるんじゃ？と思い、試したところ実現できたので紹介しようと思います。 グローバルショートカットの要件 単純に open memo.txt で開けばいいだけかと思いきや、VSCodeはプロジェクト単位やファイル単位で複数のウィンドウを扱える関係上、例えば memo.txt とは関係のないファイルやディレクトリをVSCodeで開いていたりすると、そのウィンドウ上に memo.txt が開かれてしまい、使いづらいです。 そこで、今回は以下の要件を満たすことを目指しました グローバルショートカットで memo.txt を新規ウィンドウで開く memo.txt がすでに開かれていたら、そのウィンドウをアクティブにする VSCodeですでに他のプロジェクトやファイルを開いていても memo.txt は別ウィンドウとしてアクティブにしたり新規で開くようにする ちなみに、最も単純な方法だと以下が考えられますが、それぞれ要件を満たしません。 code -n ~/Desktop/memo.txt : 新規ウィンドウで開くが、すでに開かれている場合でも新規ウィンドウで開いてしまう code -r ~/Desktop/memo.txt : すでに開かれている場合はそのウィンドウをアクティブにするが、他のプロジェクトやファイルを開いている場合はそのウィンドウ上に開かれてしまう open -a \u0026amp;quot;Visual Studio Code\u0026amp;quot; ~/Desktop/memo.txt : 他のプロジェクトやファイルを開いている場合はそのウィンドウ上に開かれてしまう AppleScriptで実現する ではどうやって実現するかというと、 AppleScript を使います。具体的には以下のようなシンプルなスクリプトを書きます。 tell application \u0026amp;#34;System Events\u0026amp;#34; tell process \u0026amp;#34;Code\u0026amp;#34; set windowList to windows repeat with w in windowList if name of w contains \u0026amp;#34;memo.txt\u0026amp;#34; then tell application \u0026amp;#34;Visual Studio Code\u0026amp;#34; to activate -- アプリを最前面に perform action \u0026amp;#34;AXRaise\u0026amp;#34; of w -- ウィンドウをアクティブに return end if end repeat end tell end tell -- なければ新規ウィンドウで開く do shell script \u0026amp;#34;/usr/local/bin/code --new-window /Users/user/Desktop/memo.txt\u0026amp;#34; このスクリプトは、まさにさっきの要件を満たすように動作します。まず、 System Events を使ってVSCodeのウィンドウ一覧を取得し、その中に memo.txt が開かれているウィンドウがあるかどうかを調べます。もし見つかったら、そのウィンドウをアクティブにして終了します。見つからなかった場合は、最後の行で code --new-window コマンドを使って新規ウィンドウで memo.txt を開きます。 BetterTouchToolでグローバルショートカットに設定する このスクリプトをBetterTouchToolでグローバルショートカットに設定します。 BetterTouchToolを起動し、上部のメニューから「キーボードショートカット」を選択します。 「+」マークでキーボードショートカットを追加します 一番右に表示されている詳細設定画面の「ショートカットを記録するには、下記をクリック」をクリックしキーボードショートカットを設定します 真ん中に表示されている「選択したトリガーに最初の処理を割り当てる」の「＋」を押して「Apple Script を実行する（ブロック）」を選択します 表示されたAppleScriptの入力欄に、先ほどのスクリプトを貼り付けます Cmd + S などで保存します 使ってみる ↑の例では、 Cmd + Shift + \\ にショートカットを割り当てました。 これにより、どのアプリを使っていても Cmd + Shift + \\ を押すと memo.txt が新規ウィンドウで開かれたり、すでに開かれていたらそのウィンドウがアクティブになったりします。また、一番重要だった、すでにVSCodeで他のプロジェクトやファイルを開いていても、 memo.txt は別ウィンドウとして開かれたりアクティブになったりします!（重要） まとめ 今回は、BetterTouchToolを使ってグローバルなキーボードショートカットで特定のテキストファイルをVisual Studio Codeで開けるようにする方法を紹介しました。AppleScriptを活用することで、細かい要件にも対応できる柔軟な設定が可能です。参考になれば幸いです。 "},{"title":"Ghostty の設定を別ファイルで管理し、Gitでバックアップ・同期しやすくする方法","permalink":"/posts/20251226_ghostty-customized-config-management/","date":"2025-12-26","summary":"最近流行ってるターミナルエミュレーター Ghostty を使い始めました。設定をテキストでカスタマイズできるのがとても魅力的です。ただ、 Settings から直接設定を書き換える方法だと、アプリが管理してるデフォルトの設定ファイルへ内容が書き込まれてしまうため、バックアップや他の端末との同期が困難です。\nそこで今回は、 config-file という設定項目を使った Ghostty の設定管理方 …","tags":["ghostty","config","management","mac"],"content":"最近流行ってるターミナルエミュレーター Ghostty を使い始めました。設定をテキストでカスタマイズできるのがとても魅力的です。ただ、 Settings から直接設定を書き換える方法だと、アプリが管理してるデフォルトの設定ファイルへ内容が書き込まれてしまうため、バックアップや他の端末との同期が困難です。 そこで今回は、 config-file という設定項目を使った Ghostty の設定管理方法を紹介します。 具体的には、以下のような構成にすることで、カスタマイズした Ghostty の設定を別ファイル管理にし、そちらをGit管理にすることでバックアップや他端末と簡単に同期させられるようにしています。 デフォルトのGhostty設定ファイル → 「カスタム設定ファイル」へのファイルパスを指定 カスタム設定ファイル（Git管理下に置く） → 具体的なカスタマイズの設定内容を記述 詳しく説明 まず、カスタマイズした設定を保存するディレクトリを用意します。 このディレクトリはGit管理下においておき、可能なら Github.com などのリモートリポジトリで管理できると便利です。 そして、このディレクトリに Ghostty のカスタマイズしたい設定を書いたconfigファイルを作成します（このファイルが設定ファイルの実体となります）。例えば、以下のような内容にします。 $ cat \u0026amp;#34;/Users/user/Develop/ghq/github.com/xshoji/ghostty-config/custom_config\u0026amp;#34; #-------------------- # Common configuration settings #-------------------- # Set terminal title to a single space to hide it title = \u0026amp;#34; \u0026amp;#34; 次に、Ghostty のアプリを起動し、メニューバーの「Ghostty」から「Settings」を開きます。このデフォルトの設定ファイルへ config-file の設定を使って、先ほど作成したカスタム設定ファイルへのパスを指定します。 $ cat \u0026amp;#34;/Users/user/Library/Application Support/com.mitchellh.ghostty/config\u0026amp;#34; |tail -n 2 # この一行だけ最後の行に追加する config-file = \u0026amp;#34;/Users/user/Develop/ghq/github.com/xshoji/ghostty-config/custom_config\u0026amp;#34; 最後に、メニューバーの「Ghostty」から「Reload Configuration」を選択して設定を反映させます。 この構成にすることで、Ghostty は起動時にカスタマイズした設定ファイルを読み込むようになります。以降は /Users/user/Develop/ghq/github.com/xshoji/ghostty-config/custom_config を編集して設定を変更し、Gitで管理・同期します。 GhosttyのConfig関連の基礎知識 file-location - Configuration https://ghostty.org/docs/config#file-location Ghosttyの設定ファイルは、Macの場合は以下のディレクトリに保存されています。 ~/Library/Application Support/com.mitchellh.ghostty/config さらに、以下のパスにConfigファイルがあることで最初にそちらを読み込むようになっているようです。 ~/.config/ghostty/config ドキュメントを読むと If both locations exist, they are loaded in the order above with conflicting values in later files overriding earlier ones. Configuration is optional and if no configuration file is found, Ghostty will use its defaults. ─ 両方の設定ファイルが存在する場合、上記の順序で読み込まれ、 後のファイルで指定された値が前のファイルの値を上書きします。 設定は任意であり、設定ファイルが存在しない場合、Ghostty はデフォルト設定を使用します。 と書かれており、 上記の順序で読み込まれ の部分は ~/.config/ghostty/config が最初に読み込まれ 次に ~/Library/Application Support/com.mitchellh.ghostty/config が読み込まれる（設定が被ったら後勝ち） の意味です。 今回紹介した config-file の設定を使う方法は、後者の ~/Library/Application Support/com.mitchellh.ghostty/config の中身を別ファイルに委譲する形にする、ということになります。 "},{"title":"Wayback Machine で過去のページを手軽に確認できる Bookmarklet","permalink":"/posts/20251225_wayback-machine-bookmarklet/","date":"2025-12-25","summary":"調査や資料集めの際、手元にあるURLにアクセスすると\n過去に見れていたページが消えている ページの内容が変わってしまっている といった事がよくあります。 そんな時に便利なのが Wayback Machine です。 Wayback Machineは過去に保存されたWebページのスナップショットを閲覧できるサービスです。\nで、Wayback Machineにアクセスして、URLを入力して、過去のスナ …","tags":["bookmarklet","javascript","wayback-machine","web archive"],"content":"調査や資料集めの際、手元にあるURLにアクセスすると 過去に見れていたページが消えている ページの内容が変わってしまっている といった事がよくあります。 そんな時に便利なのが Wayback Machine です。 Wayback Machineは過去に保存されたWebページのスナップショットを閲覧できるサービスです。 で、Wayback Machineにアクセスして、URLを入力して、過去のスナップショットを探せば話は終わりなんですが、若干面倒です。もっと手軽にできないかと思い、めっちゃシンプルなBookmarkletを作成しました。 このBookmarkletをブラウザのブックマークバーに登録しておくと、閲覧中のページのWayback Machineのスナップショット一覧ページをワンクリックで開けます。 特に、スマホで記事を見たときに「あれ、前と内容が違う？」と思ったときにすぐに確認できるのが便利です。 Bookmarklet のコード ブックマークレットのコードは以下の通りです。これをコピーして、ブラウザのブックマークバーに新規ブックマークとして登録してください。名前は「Wayback Machine」などお好きな名前でOKです。 javascript: (() =\u0026amp;gt; { const url = new URL(window.location.href); const archiveUrl = `https://web.archive.org/web/*/${url.hostname}${url.pathname}`; window.open(archiveUrl, \u0026amp;#39;_blank\u0026amp;#39;); })(); どんな感じか せっかくなので、特に便利に感じたiOSでの利用シーンを紹介します。 Your browser does not support the video tag. 使い所 以下のような使い所があると思っていて、それらがより \u0026amp;ldquo;手軽にできる\u0026amp;rdquo; ようになるのがこのBookmarkletの利点です。 過去確かに書いてあった仕様やアナウンスなどを時間を遡って確認し証跡にする URLが変わったなどの理由でアクセスできなくなった過去の公式ドキュメントを見る よく見るサービスやサイトのUIが変わった際に差分を比較する まとめ Wayback Machineは非常に便利なサービスですが、いちいちURLを入力して過去のスナップショットを探すのは面倒です。今回紹介したBookmarkletを使うことで、閲覧中のページのWayback Machineのスナップショット一覧ページをワンクリックで開けるようになります。特にスマホでの利用シーンで便利さを感じると思いますので、ぜひ試してみてください。 "},{"title":"Macの画面録画を右クリックから簡単にエンコードできるようにするTips","permalink":"/posts/20251224_demo_video_making_tips/","date":"2025-12-24","summary":"自作のツールの動きを見せたい時や、動作の証跡を残したい時などにMacの画面録画機能で動画を撮ることがあります。ただ、Macの録画機能で撮影された動画はそのままだと結構重いので、SlackやGithubに載せるとなるとエンコードしないとそのままでは扱いづらいです。ターミナルからコマンドを思い出して、ffmpeg等でエンコードすれば良いのですが、できればもっと簡単にサクッとやりたいです。\nそこで今回は …","tags":["mac","video","ffmpeg","handbrake","automator"],"content":"自作のツールの動きを見せたい時や、動作の証跡を残したい時などにMacの画面録画機能で動画を撮ることがあります。ただ、Macの録画機能で撮影された動画はそのままだと結構重いので、SlackやGithubに載せるとなるとエンコードしないとそのままでは扱いづらいです。ターミナルからコマンドを思い出して、ffmpeg等でエンコードすれば良いのですが、できればもっと簡単にサクッとやりたいです。 そこで今回は、Macで画面を録画した後、その動画ファイルの右クリックメニューからサクッとエンコードしてお手軽にデモ動画を作る方法を紹介します。 そもそもMacならデフォルトで右クリックからエンコードできるんじゃないの？ と思った方。その通りです。なので、エンコードにこだわらない場合は、この記事の方法を使う必要はありません。ただ、この記事の最後にMac標準の方法でエンコードした場合とのサイズ比較を載せてますが、HandBrakeCLI等のツールでエンコードした方がより高圧縮で画質も良いのでこの記事で紹介する方法も覚えておくと良いと思います。 準備するもの エンコーダー（ffmpeg, HandBrakeCLIなど） Automatorによるクイックアクション 画面録画した動画ファイル それぞれ順番に説明していきます。 エンコーダーのインストール ここでは、手軽に使えるHandBrakeCLIを使う方法を紹介します。Homebrewで簡単にインストールできます。 brew install handbrake これでインストールできます。 インストールが完了したら HandBrakeCLI --version でインストールできていることを確認しましょう。 Automatorでクイックアクションを作成 次に、Automatorを使って右クリックメニューからエンコードできるようにします。 Macに標準でインストールされている Automator を起動します。 ここでもしファイルを選択するような画面になっていたら、一旦閉じて大丈夫です。（初回起動だとこの画面になると思います） 閉じたら、メニューバーの「ファイル」-\u0026amp;gt;「新規」-\u0026amp;gt;「クイックアクション」を新規作成します。 画面の左から二列目あたりのクイックアクションの種類の中から「シェルスクリプトを実行」を選択し、以下のコードを貼り付けます。 for f in \u0026amp;#34;$@\u0026amp;#34; do # 環境によっては /opt/homebrew/bin/HandBrakeCLI にインストールされているかもしれません /usr/local/bin/HandBrakeCLI --preset \u0026amp;#34;Fast 1080p30\u0026amp;#34; -i \u0026amp;#34;${f}\u0026amp;#34; -o \u0026amp;#34;${f%.*}_encoded.mp4\u0026amp;#34; done この時、クイックアクションメニューを以下のように設定することを忘れないようにしてください。 設定できたら「Encode Video」などで保存します。 この後登場しますが、この時点で動画ファイルを右クリックすると、「クイックアクション」のメニューの中に「Encode Video」が表示されるようになります。 2025-12-27(土) 追記 このスクショを見て気づいたんですが、Mac標準の「ビデオをエンコード」も同じように右クリックメニューから実行できるんですね。 知りませんでした。こちらはHandBrakeCLIではなく、Mac標準のエンコード方法で動画を圧縮します。 なので、特にこだわりがなければこちらを使うのもありです。 ただ、最後に載せているサイズ比較を見るとわかる通り、HandBrakeCLIの方が圧倒的に高圧縮で画質も良いので、普段使うならこの記事で紹介する方法を強くオススメします！ 画面録画して動画を作成 あとは、Macの画面録画機能で動画を作成します。ショートカット Shift + Command + 5 を押すと画面録画のメニューが表示されるので、全画面録画や選択範囲録画などを選んで録画を開始します。 エンコードする 録画が終わったら、保存された動画ファイルを右クリックし、「クイックアクション」-\u0026amp;gt;「Encode Video」を選択します。 そうすると、先ほどAutomatorで作成したクイックアクションが実行され、エンコードされた動画ファイルが同じディレクトリに保存されます。 ファイル名は元のファイル名の末尾に _encoded.mp4 が付与された名前になります。ちょうど以下のような感じです。 $ ls -al total 16344 drwxr-xr-x 4 user wheel 128 12 24 02:13 . drwxrwxrwt 7 root wheel 224 12 24 02:13 .. -rw-r--r--@ 1 user wheel 6264075 12 24 02:13 video.mov -rw-r--r-- 1 user wheel 1231050 12 24 02:13 video_encoded.mp4 クイックアクションの保存場所 ちょっとわかりにくいですが、先ほど作成したクイックアクションの保存先は /Users/user/Library/Services/Encode Video.workflow になるようです。もしクイックアクションを編集したい場合は、ここに移動してダブルクリックすればAutomatorで開けます。 エンコードする際の画質を調整したい（HandBrakeCLIの場合） クイックアクションのスクリプトで指定してる --preset \u0026amp;#34;Fast 1080p30\u0026amp;#34; の部分を変更すると任意のプリセットに変更できます。HandBrakeCLIで利用できるプリセットは以下のコマンドで確認できます。 HandBrakeCLI --preset-list この記事で紹介してるもの含めておすすめの設定を載せておきます。 Fast 1080p30: そこそこ画質が良くて程よく圧縮率が良い設定 Fast 576p25 : 画質は落ちるけどサイズを小さくしたい時おすすめ Mac標準のエンコード方法とのサイズ比較 Mac標準の機能でエンコードもできるようなので、その方法とのサイズ比較してみました。 条件は以下のとおりです。 元動画 Macで録画した動画ファイル 24,442,711 bytes (約24.4MB) エンコード方法 Handbrake H.264 Handbrake H.265 Handbrake VP9 Handbrake AV1 Mac標準の「ビデオをエンコード」 エンコード後の解像度パターン 480p 720p HandBrakeCLIでのエンコードに使ったコマンドは以下の通りです。 # 480p /usr/local/bin/HandBrakeCLI --preset=\u0026amp;#34;Fast 480p30\u0026amp;#34; -i ~/Desktop/sample.mov -o \u0026amp;#34;sample_h264_480p30.mp4\u0026amp;#34; …"},{"title":"Webページをスマホ向けのデザインに最適化する Bookmarklet","permalink":"/posts/20251215_bookmarklet-for-optimizing-web-pages-for-mobile-design/","date":"2025-12-15","summary":"普段 iPhone を使っていて、Safari でブログをよく読むのですが、スマホ向けに最適化されていないページがまだ多く、見にくいと感じることがよくあります。 Safari には「リーダー表示」という機能があり、記事本文だけを抽出して見やすく表示できますが\niPhoneのSafariで記事を読んでいるときに気をそらすものを非表示にする - Apple サポート （日本） …","tags":["bookmarklet","mobile","css","javascript"],"content":"普段 iPhone を使っていて、Safari でブログをよく読むのですが、スマホ向けに最適化されていないページがまだ多く、見にくいと感じることがよくあります。 Safari には「リーダー表示」という機能があり、記事本文だけを抽出して見やすく表示できますが iPhoneのSafariで記事を読んでいるときに気をそらすものを非表示にする - Apple サポート （日本） https://support.apple.com/ja-jp/guide/iphone/iphdc30e3b86/ios リーダー表示に対応していないページもあります。また、リーダー表示にしても、コードブロックや文中の変数のスタイルがわかりにくく、痒いところに手が届かないと感じることがあります。 そうした悩みがあり、スマホ向けに最適化されていないページを見やすくする Bookmarklet（ブックマークレット）を作成しました。 今回は作成した Bookmarklet の紹介と使い方を説明します。 スマホで Bookmarklet を設定する方法 Bookmarkletの設定方法は以下の通りです。 お使いのブラウザで適当なページをお気に入り登録する Bookmarkletのコードをコピーする 先ほど登録したお気に入りを編集する URLの部分にコピーしたBookmarkletのコードを貼り付ける 名前をわかりやすい名前に変更する ( 例: Optimize for Mobile ) 保存する これで設定は完了です。 Bookmarklet のコード 「2.」で設定するBookmarkletのコードを以下に示します。 だいぶ長いので、中身は気にせずにコピーして設定してください。 （気になる人はコードの中身を読んでみてください。） やってることを文章で簡単に説明すると、Webページに適用されているCSSを全て無効にした後に自作のCSSを無理やり適用してる、という感じです。 Bookmarkletに設定するコードはこちら javascript:(() =\u0026amp;gt; { \u0026amp;#39;use strict\u0026amp;#39;; /* ==================== Configuration ==================== */ /** * Configuration object for the optimizer * @const {Object} */ const CONFIG = { /** Auto-apply optimization on page load */ autoApplyOptimization: true, /** Style element ID for injected CSS */ styleElementId: \u0026amp;#39;mobile-page-optimizer-style\u0026amp;#39;, /** Data attribute for storing original styles */ originalStyleAttr: \u0026amp;#39;data-original-style\u0026amp;#39;, /** Data attribute for marking disabled elements */ disabledAttr: \u0026amp;#39;data-mobile-optimizer-disabled\u0026amp;#39;, /** Button configuration */ button: { textEnabled: \u0026amp;#39;Mobile View OFF\u0026amp;#39;, textDisabled: \u0026amp;#39;Mobile View ON\u0026amp;#39;, position: { top: \u0026amp;#39;10px\u0026amp;#39;, left: \u0026amp;#39;10px\u0026amp;#39; }, zIndex: \u0026amp;#39;2147483647\u0026amp;#39;, }, /** Colors for theming */ colors: { background: \u0026amp;#39;#e8e0d5\u0026amp;#39;, text: \u0026amp;#39;#333333\u0026amp;#39;, textDark: \u0026amp;#39;#111111\u0026amp;#39;, link: \u0026amp;#39;#0060bf\u0026amp;#39;, linkVisited: \u0026amp;#39;#5a3696\u0026amp;#39;, linkHover: \u0026amp;#39;#0077cc\u0026amp;#39;, codeInline: \u0026amp;#39;#a83232\u0026amp;#39;, codeBackground: \u0026amp;#39;#f5f2ed\u0026amp;#39;, codeBorder: \u0026amp;#39;#d5c7b5\u0026amp;#39;, emphasis: \u0026amp;#39;#8B4513\u0026amp;#39;, buttonActive: \u0026amp;#39;#28a745\u0026amp;#39;, buttonInactive: \u0026amp;#39;#f8f9fa\u0026amp;#39;, }, }; /* ==================== CSS Management ==================== */ /** * Disables or enables all existing CSS on the page * Stores original styles for restoration * * @param {boolean} isDisabled - Whether to disable CSS */ const disableCss = (isDisabled) =\u0026amp;gt; { try { /* Disable external and internal stylesheets */ Array.from(document.styleSheets).forEach((sheet) =\u0026amp;gt; { try { sheet.disabled = isDisabled; } catch (e) { /* Some stylesheets may throw security errors (CORS) */ console.warn(\u0026amp;#39;Cannot disable stylesheet:\u0026amp;#39;, e); } }); if (isDisabled) { /* Save and remove inline styles */ document.querySelectorAll(\u0026amp;#39;[style]\u0026amp;#39;).forEach((el) =\u0026amp;gt; { el.setAttribute(CONFIG.originalStyleAttr, el.getAttribute(\u0026amp;#39;style\u0026amp;#39;)); el.removeAttribute(\u0026amp;#39;style\u0026amp;#39;); }); /* Disable style elements (except our own) */ document.querySelectorAll(\u0026amp;#39;style\u0026amp;#39;).forEach((el) =\u0026amp;gt; { if (el.id !== CONFIG.styleElementId) { el.setAttribute(CONFIG.disabledAttr, …"},{"title":"VSCode: ショートカットキーのみでAIに指示を送る方法","permalink":"/posts/20251214_vscode-default-keybindings-chat01/","date":"2025-12-14","summary":"VSCodeで、AIに送る指示をテンプレートにしてショートカットに設定する方法を紹介します。 この方法を活用すると、文章やコードを選択してショートカットキーを押すだけで\u0026hellip;\nAIに英訳を生成させられる メソッド単位のリファクタリングを行わる 簡単なコードレビューを依頼できる といったことが可能になります。最近は、プロンプトのmarkdownファイルを所定の場所に設置し、Chatからコマ …","tags":["vscode","chat","ai","shortcut"],"content":"VSCodeで、AIに送る指示をテンプレートにしてショートカットに設定する方法を紹介します。 この方法を活用すると、文章やコードを選択してショートカットキーを押すだけで\u0026amp;hellip; AIに英訳を生成させられる メソッド単位のリファクタリングを行わる 簡単なコードレビューを依頼できる といったことが可能になります。最近は、プロンプトのmarkdownファイルを所定の場所に設置し、Chatからコマンドで呼び出す方式が一般的だと思いますが、ここで紹介するのはそれよりもさらにお手軽な使い方ができる方法となります。 この後の説明では ショートカットキーのみでAIへ英訳の指示を出す設定 を例として設定方法を紹介していきます。また、AIは Github copilot を使います。 設定方法 具体的な設定方法としては chat - Default keyboard shortcuts reference https://code.visualstudio.com/docs/reference/default-keybindings#_chat で紹介されている VSCode 標準のキーボードショートカットを使います。今回は Open editor inline chat: ⌘I inlineChat.start のショートカットをカスタマイズすることで、ショートカットキー一発でAIへ英訳の指示を出す設定を作成してみます。 まず、VSCodeのメニューの「 Preferences -\u0026amp;gt; Keyboard Shortcuts 」を開きます。 次に、設定しやすさのためにVSCodeの右上に表示されているファイルのアイコン「 Open Keyboard Shortcuts (JSON) 」を開きます。 すると、jsonを編集する画面になるので、以下の設定を追加します。 ... { // Copilotへ翻訳依頼を出す \u0026amp;#34;key\u0026amp;#34;: \u0026amp;#34;ctrl+cmd+t\u0026amp;#34;, \u0026amp;#34;command\u0026amp;#34;: \u0026amp;#34;inlineChat.start\u0026amp;#34;, \u0026amp;#34;args\u0026amp;#34;: { \u0026amp;#34;message\u0026amp;#34;: \u0026amp;#34;#selection の文章に関して英文へ翻訳してください。その後、元の選択されている文章は削除せず、その次の行に結果を挿入してください。\u0026amp;#34;, \u0026amp;#34;autoSend\u0026amp;#34;: true } } この \u0026amp;quot;command\u0026amp;quot;: \u0026amp;quot;inlineChat.start\u0026amp;quot; で指定しているのが先ほどの Default keyboard shortcuts のリファレンスで表示されていた「Open editor inline chat」を実行するためのCommand Idです。 argsで指定してるパラメタは、公式で案内されてる場所はわからなかったのですが、以下のIssueから当たりをつけて設定しました。 workbench.action.chat.submit Doesn\u0026amp;rsquo;t work after inlineChat.start · Issue #230364 · microsoft/vscode https://github.com/microsoft/vscode/issues/230364 一応意味を説明しておくと message: AIに送信する指示のテンプレート #selection は選択されている文章をコンテキストとしてAIに伝える変数 autoSend: trueにすると、チャットウィンドウが開いた後に自動で送信される となります。 使ってみる では、設定できたので適当にファイルを開いて日本語の文章を選択し、先ほど設定したショートカット ctrl+cmd+t を実行してみてください。インラインチャットが立ち上がり、設定した指示が自動で送信され、英訳された結果が表示されたでしょうか？ こんな感じです。この方法を使うと、翻訳に限らず様々な指示をショートカットキーから簡単にAIに送信できるようになります。アイデア次第で、プロンプトファイルを用意するよりも手軽に狭いコンテキストに対して指示を投げやすくなるので、用途に応じてカスタマイズすると便利そうでした。 まとめ 今回は、VSCodeのDefault Keybindingsを活用して、ショートカットキーからAIに指示を送る方法を紹介しました。この方法を使うことで、文章の翻訳やコードのリファクタリングなど、様々なタスクを効率的に行うことができます。ぜひ試してみてください。 This time, I\u0026amp;rsquo;ve introduced a method to send instructions to AI using shortcut keys by leveraging VSCode\u0026amp;rsquo;s Default Keybindings. By using this method, you can efficiently perform various tasks such as translating text or refactoring code. Please give it a try. by Grok Code Fast 1 （作ったショートカットで英訳してみました!） "},{"title":"Postmanのエクスポート機能が廃止された件（とその解決策）","permalink":"/posts/20230802_postman-backup-dump-file-issue/","date":"2023-08-06","summary":"はじめに APIの開発で\nPostman API Platform | Sign Up for Free\nhttps://www.postman.com/ を使っていて、最近PC入れ替えを行う際、このPostmanのバックアップ機能（エクスポート機能）が消えていて大変困ったため、 何が起こっていたのかなど、Postman側の経緯や、この対策などについてまとめます。\n","tags":["postman","export","remove"],"content":"はじめに APIの開発で Postman API Platform | Sign Up for Free https://www.postman.com/ を使っていて、最近PC入れ替えを行う際、このPostmanのバックアップ機能（エクスポート機能）が消えていて大変困ったため、 何が起こっていたのかなど、Postman側の経緯や、この対策などについてまとめます。 Postmanとは、エクスポート機能とは Postmanとは、HTTPリクエストをGUIから実行できるツールで、リクエスト内容をスニペット的に保存しておいたり、 一部リクエスト内容を変数化して簡単にリクエスト先やリクエスト内容を切り替えたりすることができ、APIリクエストの確認や管理を効率よく行えます。 まず、PostmanをAPI開発でどう使ってるの？については、自分は APIのリクエストをスニペット的に保存しておく APIリクエストのURLやID等を環境変数に切り出し、本番や開発環境などを簡単に呼び出し分ける APIを呼び出し前のトークン取得処理をスクリプトで自動化しておき、楽してAPIを呼び出せるようにする といった使い方をしてます。 で、最近PCの入れ替えを行った際、APIリクエストや環境変数を一括でエクスポートする機能が削除されていることに気づきました。 このエクスポート機能とは、 APIリクエストや環境変数をまとめて一つのjsonファイルとして吐き出すことができる機能です。 APIリクエストや環境変数などをまとめてバックアップ、あるいは他の人と共有したりすることができるので大変便利でした。（※1） ※1: APIリクエストのコレクション単位、環境変数単位なら個別にエクスポートすることは引き続きできるようですが、管理が面倒です。 Export all collections in postman - Stack Overflow https://stackoverflow.com/questions/57747235/export-all-collections-in-postman ここで紹介されてる通り、以前はPostmanの設定を一括でエクスポートする機能がありました。 が、最新版（具体的には、バージョン 10.10.x あたりから）からはこのエクスポートボタンが消えてます。 この機能がないと、Postmanで管理してるAPIリクエストや環境変数の情報をバックアップしておくのがとても面倒なため、代替機能含めて Postman側の案内を探してみることにしました。 世の中の反応とPostman側の反応 で、すぐ見つけたIssueがこちら。 \u0026amp;ldquo;Exporting data to single dump file\u0026amp;rdquo; feature is gone · Issue #11738 · postmanlabs/postman-app-support https://github.com/postmanlabs/postman-app-support/issues/11738 Postmanのサポートメンバーが We had to remove the data dump export due to quality and performance issue caused by that capability. データダンプのエクスポートは、その機能によって引き起こされた品質とパフォーマンスの問題のため、削除せざるを得ませんでした。 と言ってます。エクスポートする機能がパフォーマンスの問題になるってあんまりよくわからないですが、とりあえず消したかったようです。 で、Postman利用者的にはバックアップとかできないと困るので、 どうやってエクスポートすれば良いのか（代替機能は？） エクスポート機能を復活させられないのか といった質問がたくさんコメントされてます。 Postman側としては、アカウント登録をしてクラウドにデータをあげてくれってことのようですが、 社内限定のAPIとかだと クラウドにそういった社内の情報をアップロードできない場合もあるので、 ローカルのファイルにエクスポートする機能がないのは困ると、と言ってる人もいますね。 ただ、Postmanのサポートとしてはこの機能を復活させる気はないようで、 We understand that your company might not allow you to have data in the cloud, in which case, can you write to us at help@postman.com so that we can understand your company\u0026amp;rsquo;s stance better and help you out. 御社がクラウドにデータを置くことを許可していないかもしれないことは理解しています。その場合、help@postman.com へ連絡を頂ければ、御社のスタンスをよりよく理解し、お役に立てるようお手伝いします。 と回答されてます。 他にも Backup all Postman collection at once - Help - Postman Community https://community.postman.com/t/backup-all-postman-collection-at-once/44030 (2) Vinayak on Twitter: \u0026amp;ldquo;by deprecating postman scratchpad and forcing people to move online i feel many people will look for alternatives.. nightmare.. initially free tool.. then y\u0026amp;rsquo;all move to cloud and share your data with us.. fckin keys n all. https://t.co/fcZvaT2ur1.\u0026#34; / X https://twitter.com/Vgkud/status/1686385429371863047 などで同じ話題を見つけました。 このツイートのコメントにある通り、どうやらPostman側はオンラインでユーザーのデータを管理する流れに持っていきたいようですね。 まとめると、Postmanの最新版で、エクスポート機能を使うことはできないし、今後復活することもない、という状況のようです。 どうすれば良いか エクスポート機能を復活させるためにどうすれば良いか考えました。 まず、公式を見てみると、 exporting-data-dumps - Exporting data from Postman | Postman Learning Center …"},{"title":"Goのバイナリにソースコードをそのまま同梱するという提案","permalink":"/posts/20230326_proposal-packing-source-code-in-golang/","date":"2023-03-26","summary":"はじめに 業務でGoのスクリプトを書いて、バイナリをチームに配ることがよくあります。 Goでコンパイル済みのバイナリを配るメリットとしては\n実行環境に依存せずどこでも実行できる という点かなーと思います。 ただ、デメリットもあって、それは実行するバイナリがどのソースコードから生成されたものか分かりづらいという点です。\n","tags":["golang","source","proposal"],"content":"はじめに 業務でGoのスクリプトを書いて、バイナリをチームに配ることがよくあります。 Goでコンパイル済みのバイナリを配るメリットとしては 実行環境に依存せずどこでも実行できる という点かなーと思います。 ただ、デメリットもあって、それは実行するバイナリがどのソースコードから生成されたものか分かりづらいという点です。 php, python, rubyなどのスクリプト言語だとソースコードをそのまま実行するので、 中身を読むことができますし、最悪修正することも可能です。 一方、Goでビルド済みのバイナリを配布する場合、「このバイナリはこのソースで作ったよ！」という対応関係を示さない限り、 バイナリを使う利用者はソースコードの内容を把握する術がありません。 もちろん、golereaserなどを使い、コミット番号をバイナリに埋め込んだり、ちゃんとしたリリースのワークフローを介して配布すれば、 どのソースから生成されたかわからない、ということは防げるには防げるんですが ほんとに使い捨てのスクリプトなどの場合そこまでしっかり環境を整えるのは面倒な場合が多いです。 Goのバイナリにソースコードを同梱する そこで、最近「だったらもうバイナリにソースコードを含めちゃえば良いのでは？」を思い始めました。 具体的には、go 1.16から追加された embed package - embed - Go Packages https://pkg.go.dev/embed を利用して、ビルド時に自身のバイナリへ元のソースコードを埋め込んでしまえば良い。 （ただし、スクリプトがシンプルで main.go だけで構成されるような、本当にちょっとしたツールを前提にしてます。） 具体的なコードの例を示します。 package main import ( _ \u0026amp;#34;embed\u0026amp;#34; \u0026amp;#34;flag\u0026amp;#34; \u0026amp;#34;fmt\u0026amp;#34; \u0026amp;#34;os\u0026amp;#34; ) var ( //go:embed main.go srcBytes []byte paramsPrintSrc = flag.Bool(\u0026amp;#34;print-src\u0026amp;#34;, false, \u0026amp;#34;[optional] Print main.go\u0026amp;#34;) paramsHelp = flag.Bool(\u0026amp;#34;h\u0026amp;#34;, false, \u0026amp;#34;\\nhelp\u0026amp;#34;) ) func main() { flag.Parse() if *paramsHelp { flag.Usage() os.Exit(0) } if *paramsPrintSrc { fmt.Printf(\u0026amp;#34;%s\u0026amp;#34;, srcBytes) } } 上のような実装にします。で、ビルドします。 $ go build main.go こうすることで、以下のように実行時のオプション指定でバイナリの元となったソースコードを表示できます。 $ ./main -h Usage of ./main: -h help -print-src [optional] Print main.go $ ./main -print-src package main import ( _ \u0026amp;#34;embed\u0026amp;#34; \u0026amp;#34;flag\u0026amp;#34; \u0026amp;#34;fmt\u0026amp;#34; \u0026amp;#34;os\u0026amp;#34; ) ... これで、ビルド済みのバイナリの配布のみでもととなったソースも同時に配布できることになるので捗るなと思ってます。 複数ファイルの場合 複数ファイルの場合は、 embed.FS を使ってディレクトリ全体を埋め込むか、あるいはもっとお手軽にやるのであれば package main import ( \u0026amp;#34;encoding/base64\u0026amp;#34; \u0026amp;#34;flag\u0026amp;#34; \u0026amp;#34;fmt\u0026amp;#34; \u0026amp;#34;os\u0026amp;#34; ) var ( base64src string paramsPrintSrc = flag.Bool(\u0026amp;#34;print-src\u0026amp;#34;, false, \u0026amp;#34;[optional] Print main.go\u0026amp;#34;) paramsHelp = flag.Bool(\u0026amp;#34;h\u0026amp;#34;, false, \u0026amp;#34;\\nhelp\u0026amp;#34;) ) // Build: // $ go build -ldflags=\u0026amp;#34;-s -w -X \u0026amp;#39;main.base64src=$(cat main.go |base64)\u0026amp;#39;\u0026amp;#34; -trimpath main.go func main() { flag.Parse() if *paramsHelp { flag.Usage() os.Exit(0) } if *paramsPrintSrc { b, _ := base64.StdEncoding.DecodeString(base64src) fmt.Printf(\u0026amp;#34;%s\u0026amp;#34;, b) } } という実装にし、 $ go build -ldflags=\u0026amp;#34;-X \u0026amp;#39;main.base64src=$(find . -type f |xargs -I{} bash -c \u0026amp;#34;echo -e \\\u0026amp;#34;====\\n{}\\\u0026amp;#34;; cat {}\u0026amp;#34; |base64)\u0026amp;#39;\u0026amp;#34; . という感じで、ファイルをリストアップしつつ、各ファイルの内容をcatで出力し、その文字列を埋め込む形でビルドすれば、一応複数ファイルをバイナリに埋め込めます。 ソースコードを同梱するメリット 以下の点でメリットがあると思いました。 バイナリの配布先の利用者がバイナリの処理内容を確認できる バイナリの配布先の利用者が処理を修正できる ソースコード内に書いた細かい処理のコメントやスクリプトのREADME的な説明を読んで貰える （コマンドのdescriptionに書かなくても良い） おわりに ソースコードの量が膨大じゃない限りはバイナリの容量が大きくなってつらい、みたいなことはそんなにないかなーと思います。 "},{"title":"単体テスト ベストプラクティス集","permalink":"/posts/20201003_bestpractice-for-testing/","date":"2020-10-03","summary":" Modern Best Practices for Testing in Java\nhttps://phauer.com/2019/modern-best-practices-testing-java/ テスト時に何気なく気をつけている事が根拠とともに具体的に示されていて、 自分自身がテストする時はもちろん、コードレビュー時でも注意・指摘したい内容がまとめられています。\nタイトルには「Java」 …","tags":["java","unit test"],"content":" Modern Best Practices for Testing in Java https://phauer.com/2019/modern-best-practices-testing-java/ テスト時に何気なく気をつけている事が根拠とともに具体的に示されていて、 自分自身がテストする時はもちろん、コードレビュー時でも注意・指摘したい内容がまとめられています。 タイトルには「Java」と書かれていますが、プラクティスとしては言語に依存しない内容がほとんどなので、 特定の言語に限らない有益なプラクティスだと思いました。 それでは、それぞれの中身をまとめていきます。 一般的なプラクティスの話 テストメソッドでは、以下の基本ルールを守ると良いみたいです。 (1) 1つの空行で区切られた3つのブロックを含むようにする Given (Input): データ作成やモックの設定などのテスト準備 When (Action): テストしたいメソッドやアクションを呼び出す Then (Output): アサートを実行して、アクションの正しい出力や動作を検証する (2) 等値アサートで変数を使用する場合は、変数名の前に actual と expected を付ける 実際に取得される値: 変数名の前に actual をにつける 取得される値の期待値: 変数名の前に expected をつける モチベーション: 比較時の意図が明確になり間違いが減るし、可読性もあがるため (3) ランダムな値（特に時刻など）は使わない。固定値を使って再現性を高める (1) 1つの空行で区切られた3つのブロックを含むようにする (2) 等値アサートで変数を使用する場合は、変数名の前に actual と expected を付ける 最初に、(1), (2)をまとめると、以下の形が理想的です。 @Test public void getTest() { // Given UserGetRequest request = new UserGetRequest(1111L); UserDao dao = new UserDao(); // When User actualUser = dao.get(request); // Then User expectedUser = new User(1111L, \u0026amp;#34;John\u0026amp;#34;); assertThat(actualUser, is(expectedUser)); } GroovyのSpock frameworkを使っていると、構文としてこのあたりが用意されていて自然と意識する形になっていますよね。 Spock Framework Reference Documentation http://spockframework.org/spock/docs/1.3/all_in_one.html spock-workshop/02_basics.md at master · yamkazu/spock-workshop https://github.com/yamkazu/spock-workshop/blob/master/docs/02_basics.md#setup こういうフレームワークに関わらず、テストする時これらのステップごとにブロックを分けてちゃんと記述しようねってことです。 (3) ランダムな値（特に時刻など）は使わない。固定値を使って再現性を高める 結果が毎回変わるような、ランダム化される値が登場するテストは行わないようにします。 以下が悪い例です。 /** * ダメな例 */ @Test public void formatBadTest() { // Given Instant currentInstant = Instant.now(); // example =\u0026amp;gt; 1601739774 EpochSecondFormatter formatter = new EpochSecondFormatter(); // When String actualDate = formatter.format(currentInstant); // example: =\u0026amp;gt; DATE: 20201003 // Then String expectedDate = createExpectedString(currentInstant); assertThat(actualDate, is(expectedDate)); } こういうテストはアサートが失敗した場合に出るログの値が毎回変わるのでデバッグが困難になります。 また、コメントに記載されている値も役に立ちません。 以下のように、固定値を使い、毎回同じ結果になるようにします。 /** * 良い例 */ @Test public void formatGoodTest() { // Given Instant fixedInstant = Instant.ofEpochSecond(1601739774); EpochSecondFormatter formatter = new EpochSecondFormatter(); // When String actualDate = formatter.format(fixedInstant); // DATE: 20201003 // Then String expectedDate = createExpectedString(fixedInstant); assertThat(actualDate, is(expectedDate)); } こうすることでいつ実行しても毎回同じ結果になる再現性の高いテストになります。 小規模で具体的なテストを書こうという話 (1) 繰り返し使うコードは専用のメソッドに切り出し、分かりやすい記述的な名前を付ける (2) 複数回使用される値を変数に抽出するのは実はやらない方が良い (3) 期待される動作についてのテストメソッドをそれぞれ個別に用意する 期待する動作が何なのかが分かりやすいテストメソッド名にする 1つのでかいテストメソッドの中でいろんなコーナーケースのテストはやらないほうが良い (4) テストしたい部分だけをアサートする (1) 繰り返し使うコードは専用のメソッドに切り出し、分かりやすい記述的な名前を付ける テスト用のオブジェクトを作るだけのメソッド、みたいな、みんなよく無意識のうちにやってることだとは思います。 ただ、ここで大切なのは、「テストに関係するフィールドをパラメータとして指定させるメソッド」にするとより見通しが良いみたいです。 @Test public void getByIdGreaterThanTest() { // Given UserFilter userFilter = new UserFilter(Arrays.asList( createUserWithId(10L), createUserWithId(20L), createUserWithId(30L) )); // When …"},{"title":"Hugo + GitHub Pagesで作る無料ブログサイト構築（2020年版）","permalink":"/posts/20200927_instructions-for-building-a-free-blog-site-with-markdown-hugo-github-pages/","date":"2020-09-27","summary":"Hugo + GitHub Pagesでこのブログを運用していて、以下の要件を目指しました。\nお金をかけないこと Markdownで記事を書けること ブログの静的データのみ公開し、元ネタは公開しないこと 記事の更新／反映が自動化されていること 似たような要件でブログを作ってみたい人に向けて、構築の流れを紹介したいと思います。 初心者向けに細かく説明しているので若干長いと思います。\n以下にリンク付き …","tags":["hugo","blog","GitHub Pages","github action"],"content":"Hugo + GitHub Pagesでこのブログを運用していて、以下の要件を目指しました。 お金をかけないこと Markdownで記事を書けること ブログの静的データのみ公開し、元ネタは公開しないこと 記事の更新／反映が自動化されていること 似たような要件でブログを作ってみたい人に向けて、構築の流れを紹介したいと思います。 初心者向けに細かく説明しているので若干長いと思います。 以下にリンク付き目次を載せておくので、 興味があるトピックだけつまみ食いしてもらう読み方のほうが良いかもしれません。 お金をかけないこと GitHub Pages用のRepositoryを用意する GitHub Pagesを使いましょう。 GitHub Pagesとは、Github社が提供しているホスティングサービスで、 Githubのリポジトリにhtml, css, jsを置くとそれをそれらをウェブサイトとして公開、ホスティングしてくれます（無料!!）。 設定方法などはたくさん記事がありますが、 2020/10現在の最新の手順として、ここでも改めて具体的な流れを説明することにします。 最初に、Githubアカウントがなければ作りましょう。 GitHub Free プランはその名の通り無料です。 アカウントができたら、ブログ本体のリポジトリを作りましょう。 my-blog とかなんでも良いです。 ↑の通り、ここで作成するリポジトリは Public repository で作成してください。 GitHub Free プランでは、Private repositoryをGitHub Pagesとして公開することはできません。 GitHub Pages について - GitHub Docs https://docs.github.com/ja/free-pro-team@latest/github/working-with-github-pages/about-github-pages GitHub Pagesは、GitHub Free 及びGitHub FreeのOrganizationではパブリックリポジトリでのみ使用でき\u0026amp;hellip; ※2020/10現在の情報 ググると、たまにブログでPrivate repositoryでもGitHub Pagesで公開できるみたいなこと書いてある場合がありますが、 それは Github Team のプランなど、課金している場合だけです。 お金をかけたくない場合 GitHub Free になるので、おとなしくPublic repositoryを使いましょう。 ※ただし、このあと説明する方法により、ブログの元素材はPrivate repositoryで管理することができます👌 GitHub Pagesを設定して公開する 作成できたら、このリポジトリをGitHub Pagesで公開する設定を行います。 リポジトリページの右上の「Settings」から「GitHub Pages」の「Source」項目を ブランチを main に、/docs をsourceディレクトリに指定してSaveします。 （2020-10-05から、デフォルトブランチが main になったようです。前は master でした。なので、 masterになってる人はmasterでもOKです。） 完了したら、以下の内容のhtmlファイルをリポジトリの docs/index.html というパスに作成します。 \u0026amp;lt;!DOCTYPE html\u0026amp;gt; \u0026amp;lt;html\u0026amp;gt; \u0026amp;lt;head\u0026amp;gt; \u0026amp;lt;meta charset=\u0026amp;#34;UTF-8\u0026amp;#34;\u0026amp;gt; \u0026amp;lt;title\u0026amp;gt;Welcome to My GitHub Pages\u0026amp;lt;/title\u0026amp;gt; \u0026amp;lt;/head\u0026amp;gt; \u0026amp;lt;body\u0026amp;gt; \u0026amp;lt;main\u0026amp;gt; \u0026amp;lt;h1\u0026amp;gt;Welcome to My GitHub Pages\u0026amp;lt;/h1\u0026amp;gt; \u0026amp;lt;/main\u0026amp;gt; \u0026amp;lt;/body\u0026amp;gt; \u0026amp;lt;/html\u0026amp;gt; では早速作ったページにアクセスしてみます。先程と同じく、リポジトリページの右上の「Settings」から「GitHub Pages」へ行くと 自分のリポジトリのGitHub PagesのURLが表示されていると思うので、開いてみてください。 Your site is published at https://xshoji.github.io/my-blog/ ↑みたいな感じで出てるはず。 Welcome to My GitHub Pages と表示されていたらOKです。 これでGitHub Pagesの設定は完了です。 Markdownで記事を書けること Hugoを導入する Github Pagesに載せる記事を書く仕組みを作ります。 What is Hugo ｜ Hugo https://gohugo.io/about/what-is-hugo/ Hugoとは、Goで書かれた静的サイトジェネレーターです。 まぁ、Markdownで書いた記事をhtmlに変換してくれるツール、と思ってもらってOKです。 WordPressからHugoに乗り換えるひとも多いみたいで、ここ数年流行ってるのでこれを使います。 （使ってみて、実際簡単で使いやすかったです。） まず、hugoをローカルPCにインストールします。Macの場合はbrewで入れれます。 $ brew install hugo $ hugo version Hugo Static Site Generator v0.75.1/extended darwin/amd64 BuildDate: unknown インストールしたら、次はHugo用のリポジトリを作りましょう。 Hugo用のリポジトリを作る Hugo用のリポジトリを作りましょう。 my-blog-source とかなんでも良いです。 ここで作成するリポジトリは Private repository でOKです。 このリポジトリは記事の元ネタを管理するリポジトリになるので外部には公開されません。 Hugoでサイトの雛形を作る ↑で作ったリポジトリをcloneし、その中にblogの記事の元ネタとなるファイル群を生成しましょう。 #------------------------------------------ # git cloneする #------------------------------------------ $ git clone https://github.com/xshoji/my-blog-source Cloning into \u0026amp;#39;my-blog-source\u0026amp;#39;... remote: Enumerating objects: 4, done. remote: Counting objects: 100% (4/4), done. remote: Compressing objects: 100% (3/3), done. remote: …"},{"title":"スマホにおける広告の新しいターゲティング手法について","permalink":"/posts/20200926_new-targeting-techniques-for-ads/","date":"2020-09-26","summary":" Companies can track your phone’s movements to target ads ｜ Ars Technica\nhttps://arstechnica.com/information-technology/2020/09/companies-can-track-your-phones-movements-to-target-ads/ が元の記事。\n広告業界では、ト …","tags":["ads","targeting","smartphone","sensor"],"content":" Companies can track your phone’s movements to target ads ｜ Ars Technica https://arstechnica.com/information-technology/2020/09/companies-can-track-your-phones-movements-to-target-ads/ が元の記事。 広告業界では、トラッキング方法の話題が結構熱くて、最近iOS14で適用される（※2021/9に延期になった）ユーザーのトラッキング機能のデフォルトオプトアウト （ユーザーに「あなたのこと追跡するけど、いいよね？」（はい／いいえ）みたいな許可を明示的に得ないと、デフォルトでトラッキングができなくなる）や、 Google Chromeのトラッキング用のクッキーの段階的な廃止など、個人のプロファイルに基づくトラッキングができなくなってきています。 iOS 14、iPadOS 14、watchOS 14、tvOS 14は9月16日にリリース ｜ TechCrunch Japan https://jp.techcrunch.com/2020/09/16/2020-09-15-apple-ios-14-release/ Google による Cookie 廃止、「2年間」の猶予に歓迎の声 ：「実に穏やかなアプローチだ」 ｜ DIGIDAY［日本版］ https://digiday.jp/platforms/google-plans-kill-off-third-party-cookies-chrome-within-2-years/ それに対しての新しいアプローチってどんなものがある？というのが元の記事の話題。 この記事では、広告の新しいターゲティング方法として「ユーザーが何をしているか」を軸とした手法を提案、提供しているらしい。 NumberEight ｜ AI to power your content with context ｜ London, UK https://www.numbereight.ai/ この記事に出てくる NumberEight という企業では、スマホのセンサー情報に基づいてユーザーの行動を判別できるようになるSDKを提供しているそうです。 おそらく、iOSのアプリに組み込むライブラリかなと。 ちなみに、この会社の共同設立者のSenさんは Abhishek Sen - Co-Founder \u0026amp;amp; CEO - NumberEight ｜ LinkedIn https://uk.linkedin.com/in/abhisheksen 元Appleで、iPhoneやiPadのワイヤレス技術周りのソフトウェアエンジニアやってたらしい。 （なので、スマートフォン内部のセンサーなどの仕組みに詳しいとのこと） いくつか例が出てきてますが、 ジムでトレーニング中の人にプロテインの広告を出す 車で長距離通勤している人に燃費の良い新車の広告を出す みたいなターゲティングが主流になってくるのかなーみたいな。 They’d rather not collect the data than send the message that they’re tracking users, “even if they may very well be,” he says. アプリを提供する企業は、「あなたを追跡してます」というメッセージを送るくらいなら、データを収集しないほうがよいと考えているようです。 と書いてあるとおり、トラッキングという行為そのものが企業のマイナスイメージにつながるのは間違いなさそう。 AppleやGoogleの施策により、トラッキングが規制されて一時的にユーザーの匿名性は高くなる可能性はあるけど、 長期的にみると、 NumberEight のような、より個人の詳細にフォーカスしたトラッキング手法が考案されることで、 ユーザーのプライバシーの問題などに発展していきそうな気がします。 ちなみにiOSの場合は、 「高級有料アイテムあげるから、あなたのことトラッキングするけど良いよね？」（はい／いいえ） みたいなことは許容されないらしい。App Storeの審査のガイドラインに App Store Review Guidelines - Apple Developer https://developer.apple.com/app-store/review/guidelines/ 3.2.2 Unacceptable Apps should not require users to rate the app, review the app, watch videos, download other apps, tap on advertisements, enable tracking, or take other similar actions in order to access functionality, content, use the app, or receive monetary or other compensation, including but not limited to gift cards and codes. アプリは、ユーザーが機能やコンテンツにアクセスしたり、アプリを利用したり、ギフトカードやコードを含むがこれらに限定されない金銭的またはその他の報酬を受け取るために、ユーザーがアプリを評価したり、アプリをレビューしたり、動画を見たり、他のアプリをダウンロードしたり、広告をタップしたり、トラッキングを有効にしたり、その他の同様の行動を取ることを要求してはなりません。 とある。Apple厳しい\u0026amp;hellip;。 "},{"title":"SQLインジェクションフィルタを回避するためのアプローチ","permalink":"/posts/20200920_an-approach-to-avoid-sql-injection-filters/","date":"2020-09-20","summary":" Astrocamel - Blog/Portfolio of George Skouroupathis\nhttps://www.astrocamel.com/web/2020/09/04/how-i-bypassed-cloudflares-sql-injection-filter.html が元の記事で、さらっとまとめると\nCloudflareを使ってるサイトの脆弱性試験しようとしたら、そもそ …","tags":["cdn","security","sql injection"],"content":" Astrocamel - Blog/Portfolio of George Skouroupathis https://www.astrocamel.com/web/2020/09/04/how-i-bypassed-cloudflares-sql-injection-filter.html が元の記事で、さらっとまとめると Cloudflareを使ってるサイトの脆弱性試験しようとしたら、そもそもサイトまでリクエストが届いてないことが判明 CloudflareのWAFで弾かれてるっぽいから、SQLのリクエスト難読化したら無事突破できたよ って話です。この機能を回避するアプローチが面白かった。 ここでいう「難読化（obfuscation）」っていうのは、 SQLの意味はそのままに、Cloudflareのフィルタをパスできるクエリの加工のことのようです。 （CDNのレイヤで、リクエストの中身まで見て攻撃を防ぐみたいなことしてるの知らなかった・・・。） あと、目的のサイトの脆弱性試験しようとしたら、Cloudflareの脆弱性試験になってるやんっていう。 具体的な流れのサマリーは以下の通り。 脆弱性試験の対象サイトはMySQL + PHPのよくあるサイト POSTリクエストでTime-based SQL Injection使って試験しようとした 何故かリクエストがサイトに届かない CloudflareのWAF（SQLインジェクションフィルタ）で弾かれてるっぽい どういうリクエストが弾かれるか調べよう 文字とか=とかをPOSTすると弾かれるっぽい いろいろSQL難読化したら無事突破できました 無事突破したことをCloudflareに報告したらTシャツゲットしたよ みたいなことのようです。ここで出てくる「Time-based SQL Injection」ってのは、 Time-based SQL Injectionは意外に実用的だった ｜ 徳丸浩の日記 https://blog.tokumaru.org/2015/04/time-based-sql-injection.html Time-based SQL Injectionとは\u0026amp;hellip; 特定の条件にヒットする場合にのみ一定秒数Sleepする、というSQL（sleep()関数とかを使って）をInjectionすることで、 ヒットする場合としない場合の応答時間の差を利用して情報を盗む手法のこと。 らしいです。へー。 （後で気づいたけど、かの有名な徳丸さんのサイトだった） あ、あと全部のSQLインジェクションが弾かれるわけではなかったみたいなのでそこは注意。 結局この人の場合、Time-based SQL Injectionという手法が使えなかったため、 その時に試すことができたSQLインジェクションを使って、 結果が返りうるSQLをインジェクション（例：... WHERE \u0026#39;a\u0026#39; = \u0026#39;a\u0026#39;）: 200 OK 結果が返らないSQLをインジェクション（例：... WHERE \u0026#39;a\u0026#39; = \u0026#39;b\u0026#39;）: 500 Internal Server Error となる特性を発見し、これを利用してテーブル名やカラム名の特定を行う方法を探っていったみたい。 で、どうやって特定するのかというと、テーブルやカラム名が格納されているDBのメタテーブルに対して、 WHERE \u0026amp;lsquo;a\u0026amp;rsquo; = メタテーブルの中のテーブル名の1文字目 WHERE \u0026amp;lsquo;b\u0026amp;rsquo; = メタテーブルの中のテーブル名の1文字目 \u0026amp;hellip; と繰り返す。1文字目が分かったら WHERE \u0026amp;lsquo;a\u0026amp;rsquo; = メタテーブルの中のテーブル名の2文字目 WHERE \u0026amp;lsquo;b\u0026amp;rsquo; = メタテーブルの中のテーブル名の2文字目 \u0026amp;hellip; と繰り返す。以下繰り返し って感じでブルートフォース攻撃を行ったらしい。 この比較を行うSQLが実行されると、↑の通りサーバーとしては 合ってたら: 200 OK 間違いなら: 500 Internal Server Error となり、がっつりチェック可能ということになります。 で、具体的にどういうふうにSQLを難読化したかについては元の記事に詳しく載っているのでそちらを参照ください。 所感として、SQLインジェクション自体をさせないことも重要だけど、 エラーハンドリングが甘いと↑のように攻撃者に手がかりを与えてしまうことになるなーと痛感しました。 "}]